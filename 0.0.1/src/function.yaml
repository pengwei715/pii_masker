kind: job
metadata:
  name: pii-recognizer
  tag: ''
  hash: f3378a7ab25ce1c20ac5d313dbc3ee7f207239e2
  project: default
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  build:
    functionSourceCode: ZnJvbSBwcmVzaWRpb19hbm9ueW1pemVyIGltcG9ydCBBbm9ueW1pemVyRW5naW5lCmZyb20gYW5ub3RhdGVkX3RleHQudXRpbCBpbXBvcnQgZ2V0X2Fubm90YXRlZF9odG1sCmZyb20ganNvbiBpbXBvcnQgSlNPTkVuY29kZXIKaW1wb3J0IGpzb24KaW1wb3J0IHdhcm5pbmdzCmltcG9ydCBvcwppbXBvcnQgbG9nZ2luZwpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIExpc3QsIFR1cGxlLCBTZXQKaW1wb3J0IG1scnVuCgpmcm9tIHByZXNpZGlvX2FuYWx5emVyIGltcG9ydCAoCiAgICBSZWNvZ25pemVyUmVnaXN0cnksCiAgICBBbmFseXplckVuZ2luZSwKICAgIFJlY29nbml6ZXJSZXN1bHQsCiAgICBMb2NhbFJlY29nbml6ZXIsCiAgICBFbnRpdHlSZWNvZ25pemVyLAogICAgUGF0dGVybiwKICAgIFBhdHRlcm5fUmVjb2duaXplciwKICAgIEFuYWx5c2lzRXhwbGFuYXRpb24sCikKZnJvbSBwcmVzaWRpb19hbmFseXplci5ubHBfZW5naW5lIGltcG9ydCBObHBBcnRpZmFjdHMKZnJvbSBwcmVzaWRpb19hbmFseXplci5wcmVkZWZpbmVkX3JlY29nbml6ZXJzLnNwYWN5X3JlY29nbml6ZXIgaW1wb3J0IFNwYWN5UmVjb2duaXplcgoKdHJ5OgogICAgZnJvbSBmbGFpci5kYXRhIGltcG9ydCBTZW50ZW5jZQogICAgZnJvbSBmbGFpci5tb2RlbHMgaW1wb3J0IFNlcXVlbmNlVGFnZ2VyCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHByaW50KCJGbGFpciBpcyBub3QgaW5zdGFsbGVkIikKCm9zLmVudmlyb25bIlRPS0VOSVpFUlNfUEFSQUxMRUxJU00iXSA9ICJmYWxzZSIKd2FybmluZ3MuZmlsdGVyd2FybmluZ3MoImlnbm9yZSIpCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKCJwaWktcmVjb2duaXplciIpCgoKY2xhc3MgUGF0dGVyblJlY29nbml6ZXJGYWN0b3J5OgogICAgRU5USVRJRVMgPSB7CiAgICAgICAgIkNSRURJVF9DQVJEIjogW1BhdHRlcm4oIkNSRURJVF9DQVJEIiwgciJcYig/OlxkWyAtXSo/KXsxMywxNn1cYiIsIDAuNSldLAogICAgICAgICJTU04iOiBbUGF0dGVybigiU1NOIiwgciJcYlxkezN9LT9cZHsyfS0/XGR7NH1cYiIsIDAuNSldLAogICAgICAgICJQSE9ORSI6IFtQYXR0ZXJuKCJQSE9ORSIsIHIiXCg/XGR7M31cKT9bLS5cc10/XGR7M31bLS5cc10/XGR7NH0iLCAwLjUpXSwKICAgICAgICAiRU1BSUwiOiBbUGF0dGVybigiRU1BSUwiLCByIlxTK0BcUysiLCAwLjUpXSwKICAgIH0KCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgY3JlYXRlX3BhdHRlcm5fcmVjb2duaXplcigpOgogICAgICAgIHJlcyA9IFtdCiAgICAgICAgZm9yIGVudGl0eSwgcGF0dGVybiBpbiBzZWxmLkVOVElUSUVTLml0ZW1zKCk6CiAgICAgICAgICAgIHJlcy5hcHBlbmQoUGF0dGVyblJlY29nbml6ZXIoc3VwcG9ydGVkX2VudGl0eT1lbnRpdHksIHBhdHRlcm5zPXBhdHRlcm4pKQogICAgICAgIHJldHVybiByZXMKCgpjbGFzcyBDdXN0b21TcGFjeVJlY29nbml6ZXIoTG9jYWxSZWNvZ25pemVyKToKICAgIEVOVElUSUVTID0gWwogICAgICAgICJMT0NBVElPTiIsCiAgICAgICAgIlBFUlNPTiIsCiAgICAgICAgIk5SUCIsCiAgICAgICAgIk9SR0FOSVpBVElPTiIsCiAgICAgICAgIkRBVEVfVElNRSIsCiAgICBdCgogICAgREVGQVVMVF9FWFBMQU5BVElPTiA9ICgKICAgICAgICAiSWRlbnRpZmllZCBhcyB7fSBieSBTcGFjeSdzIE5hbWVkIEVudGl0eSBSZWNvZ25pdGlvbiAoUHJpdnktdHJhaW5lZCkiCiAgICApCgogICAgQ0hFQ0tfTEFCRUxfR1JPVVBTID0gWwogICAgICAgICh7IkxPQ0FUSU9OIn0sIHsiTE9DIiwgIkxPQ0FUSU9OIiwgIlNUUkVFVF9BRERSRVNTIiwgIkNPT1JESU5BVEUifSksCiAgICAgICAgKHsiUEVSU09OIn0sIHsiUEVSIiwgIlBFUlNPTiJ9KSwKICAgICAgICAoeyJOUlAifSwgeyJOT1JQIiwgIk5SUCJ9KSwKICAgICAgICAoeyJPUkdBTklaQVRJT04ifSwgeyJPUkcifSksCiAgICAgICAgKHsiREFURV9USU1FIn0sIHsiREFURV9USU1FIn0pLAogICAgXQoKICAgIE1PREVMX0xBTkdVQUdFUyA9IHsKICAgICAgICAiZW4iOiAiYmVraS9lbl9zcGFjeV9waWlfZGlzdGlsYmVydCIsCiAgICB9CgogICAgUFJFU0lESU9fRVFVSVZBTEVOQ0VTID0gewogICAgICAgICJQRVIiOiAiUEVSU09OIiwKICAgICAgICAiTE9DIjogIkxPQ0FUSU9OIiwKICAgICAgICAiT1JHIjogIk9SR0FOSVpBVElPTiIsCiAgICAgICAgIk5ST1AiOiAiTlJQIiwKICAgICAgICAiREFURV9USU1FIjogIkRBVEVfVElNRSIsCiAgICB9CgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgc3VwcG9ydGVkX2xhbmd1YWdlOiBzdHIgPSAiZW4iLAogICAgICAgIHN1cHBvcnRlZF9lbnRpdGllczogT3B0aW9uYWxbTGlzdFtzdHJdXSA9IE5vbmUsCiAgICAgICAgY2hlY2tfbGFiZWxfZ3JvdXBzOiBPcHRpb25hbFtUdXBsZVtTZXQsIFNldF1dID0gTm9uZSwKICAgICAgICBjb250ZXh0OiBPcHRpb25hbFtMaXN0W3N0cl1dID0gTm9uZSwKICAgICAgICBuZXJfc3RyZW5ndGg6IGZsb2F0ID0gMC44NSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgSW5pdGlhbGl6ZSBTcGFjeSBSZWNvZ25pemVyLgogICAgICAgIDpwYXJhbSBzdXBwb3J0ZWRfbGFuZ3VhZ2U6IExhbmd1YWdlIHRvIHVzZQogICAgICAgIDpwYXJhbSBzdXBwb3J0ZWRfZW50aXRpZXM6IEVudGl0aWVzIHRvIHVzZQogICAgICAgIDpwYXJhbSBjaGVja19sYWJlbF9ncm91cHM6IExhYmVsIGdyb3VwcyB0byBjaGVjawogICAgICAgIDpwYXJhbSBjb250ZXh0OiBDb250ZXh0IHRvIHVzZQogICAgICAgIDpwYXJhbSBuZXJfc3RyZW5ndGg6IE5FUiBzdHJlbmd0aCB0byB1c2UKICAgICAgICA6cmV0dXJucyBTcGFjeVJlY29nbml6ZXIgb2JqZWN0CiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5uZXJfc3RyZW5ndGggPSBuZXJfc3RyZW5ndGgKICAgICAgICBzZWxmLmNoZWNrX2xhYmVsX2dyb3VwcyA9ICgKICAgICAgICAgICAgY2hlY2tfbGFiZWxfZ3JvdXBzIGlmIGNoZWNrX2xhYmVsX2dyb3VwcyBlbHNlIHNlbGYuQ0hFQ0tfTEFCRUxfR1JPVVBTCiAgICAgICAgKQogICAgICAgIHN1cHBvcnRlZF9lbnRpdGllcyA9IHN1cHBvcnRlZF9lbnRpdGllcyBpZiBzdXBwb3J0ZWRfZW50aXRpZXMgZWxzZSBzZWxmLkVOVElUSUVTCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygKICAgICAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzPXN1cHBvcnRlZF9lbnRpdGllcywKICAgICAgICAgICAgc3VwcG9ydGVkX2xhbmd1YWdlPXN1cHBvcnRlZF9sYW5ndWFnZSwKICAgICAgICApCgogICAgZGVmIGxvYWQoc2VsZikgLT4gTm9uZToKICAgICAgICAiIiJMb2FkIHRoZSBtb2RlbCwgbm90IHVzZWQuIE1vZGVsIGlzIGxvYWRlZCBkdXJpbmcgaW5pdGlhbGl6YXRpb24uIiIiCiAgICAgICAgcGFzcwoKICAgIGRlZiBnZXRfc3VwcG9ydGVkX2VudGl0aWVzKHNlbGYpIC0+IExpc3Rbc3RyXToKICAgICAgICAiIiIKICAgICAgICBSZXR1cm4gc3VwcG9ydGVkIGVudGl0aWVzIGJ5IHRoaXMgbW9kZWwuCiAgICAgICAgOnJldHVybnMgTGlzdCBvZiB0aGUgc3VwcG9ydGVkIGVudGl0aWVzLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLnN1cHBvcnRlZF9lbnRpdGllcwoKICAgIGRlZiBidWlsZF9zcGFjeV9leHBsYW5hdGlvbigKICAgICAgICBzZWxmLCBvcmlnaW5hbF9zY29yZTogZmxvYXQsIGV4cGxhbmF0aW9uOiBzdHIKICAgICkgLT4gQW5hbHlzaXNFeHBsYW5hdGlvbjoKICAgICAgICAiIiIKICAgICAgICBDcmVhdGUgZXhwbGFuYXRpb24gZm9yIHdoeSB0aGlzIHJlc3VsdCB3YXMgZGV0ZWN0ZWQuCiAgICAgICAgOnBhcmFtIG9yaWdpbmFsX3Njb3JlOiBTY29yZSBnaXZlbiBieSB0aGlzIHJlY29nbml6ZXIKICAgICAgICA6cGFyYW0gZXhwbGFuYXRpb246IEV4cGxhbmF0aW9uIHN0cmluZwogICAgICAgIDpyZXR1cm5zOiBBbmFseXNpc0V4cGxhbmF0aW9uIG9iamVjdAogICAgICAgICIiIgogICAgICAgIGV4cGxhbmF0aW9uID0gQW5hbHlzaXNFeHBsYW5hdGlvbigKICAgICAgICAgICAgcmVjb2duaXplcj1zZWxmLl9fY2xhc3NfXy5fX25hbWVfXywKICAgICAgICAgICAgb3JpZ2luYWxfc2NvcmU9b3JpZ2luYWxfc2NvcmUsCiAgICAgICAgICAgIHRleHR1YWxfZXhwbGFuYXRpb249ZXhwbGFuYXRpb24sCiAgICAgICAgKQogICAgICAgIHJldHVybiBleHBsYW5hdGlvbgoKICAgIGRlZiBhbmFseXplKHNlbGYsIHRleHQsIGVudGl0aWVzLCBubHBfYXJ0aWZhY3RzPU5vbmUpOiAgIyBub3FhIEQxMDIKICAgICAgICAiIiIKICAgICAgICBBbmFseXplIHRleHQgdXNpbmcgU3BhY3kuCiAgICAgICAgOnBhcmFtIHRleHQ6IFRleHQgdG8gYW5hbHl6ZQogICAgICAgIDpwYXJhbSBlbnRpdGllczogRW50aXRpZXMgdG8gYW5hbHl6ZQogICAgICAgIDpwYXJhbSBubHBfYXJ0aWZhY3RzOiBOTFAgYXJ0aWZhY3RzIHRvIHVzZQogICAgICAgIDpyZXR1cm5zOiBMaXN0IG9mIFJlY29nbml6ZXJSZXN1bHQgb2JqZWN0cwogICAgICAgICIiIgogICAgICAgIHJlc3VsdHMgPSBbXQogICAgICAgIGlmIG5vdCBubHBfYXJ0aWZhY3RzOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygiU2tpcHBpbmcgU3BhQ3ksIG5scCBhcnRpZmFjdHMgbm90IHByb3ZpZGVkLi4uIikKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMKCiAgICAgICAgbmVyX2VudGl0aWVzID0gbmxwX2FydGlmYWN0cy5lbnRpdGllcwoKICAgICAgICBmb3IgZW50aXR5IGluIGVudGl0aWVzOgogICAgICAgICAgICBpZiBlbnRpdHkgbm90IGluIHNlbGYuc3VwcG9ydGVkX2VudGl0aWVzOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZm9yIGVudCBpbiBuZXJfZW50aXRpZXM6CiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5fX2NoZWNrX2xhYmVsKGVudGl0eSwgZW50LmxhYmVsXywgc2VsZi5jaGVja19sYWJlbF9ncm91cHMpOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB0ZXh0dWFsX2V4cGxhbmF0aW9uID0gc2VsZi5ERUZBVUxUX0VYUExBTkFUSU9OLmZvcm1hdChlbnQubGFiZWxfKQogICAgICAgICAgICAgICAgZXhwbGFuYXRpb24gPSBzZWxmLmJ1aWxkX3NwYWN5X2V4cGxhbmF0aW9uKAogICAgICAgICAgICAgICAgICAgIHNlbGYubmVyX3N0cmVuZ3RoLCB0ZXh0dWFsX2V4cGxhbmF0aW9uCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBzcGFjeV9yZXN1bHQgPSBSZWNvZ25pemVyUmVzdWx0KAogICAgICAgICAgICAgICAgICAgIGVudGl0eV90eXBlPWVudGl0eSwKICAgICAgICAgICAgICAgICAgICBzdGFydD1lbnQuc3RhcnRfY2hhciwKICAgICAgICAgICAgICAgICAgICBlbmQ9ZW50LmVuZF9jaGFyLAogICAgICAgICAgICAgICAgICAgIHNjb3JlPXNlbGYubmVyX3N0cmVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGFuYWx5c2lzX2V4cGxhbmF0aW9uPWV4cGxhbmF0aW9uLAogICAgICAgICAgICAgICAgICAgIHJlY29nbml0aW9uX21ldGFkYXRhPXsKICAgICAgICAgICAgICAgICAgICAgICAgUmVjb2duaXplclJlc3VsdC5SRUNPR05JWkVSX05BTUVfS0VZOiBzZWxmLm5hbWUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc3BhY3lfcmVzdWx0KQoKICAgICAgICByZXR1cm4gcmVzdWx0cwoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBfX2NoZWNrX2xhYmVsKAogICAgICAgIGVudGl0eTogc3RyLCBsYWJlbDogc3RyLCBjaGVja19sYWJlbF9ncm91cHM6IFR1cGxlW1NldCwgU2V0XQogICAgKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIENoZWNrIGlmIHRoZSBsYWJlbCBpcyBpbiB0aGUgbGFiZWwgZ3JvdXAuCiAgICAgICAgOnBhcmFtIGVudGl0eTogRW50aXR5IHRvIGNoZWNrCiAgICAgICAgOnBhcmFtIGxhYmVsOiBMYWJlbCB0byBjaGVjawogICAgICAgIDpwYXJhbSBjaGVja19sYWJlbF9ncm91cHM6IExhYmVsIGdyb3VwcyB0byBjaGVjawogICAgICAgIDpyZXR1cm5zOiBUcnVlIGlmIHRoZSBsYWJlbCBpcyBpbiB0aGUgbGFiZWwgZ3JvdXAsIEZhbHNlIG90aGVyd2lzZQogICAgICAgICIiIgogICAgICAgIHJldHVybiBhbnkoCiAgICAgICAgICAgIFtlbnRpdHkgaW4gZWdycCBhbmQgbGFiZWwgaW4gbGdycCBmb3IgZWdycCwgbGdycCBpbiBjaGVja19sYWJlbF9ncm91cHNdCiAgICAgICAgKQoKCmNsYXNzIEZsYWlyUmVjb2duaXplcihFbnRpdHlSZWNvZ25pemVyKToKICAgICIiIgogICAgV3JhcHBlciBmb3IgYSBmbGFpciBtb2RlbCwgaWYgbmVlZGVkIHRvIGJlIHVzZWQgd2l0aGluIFByZXNpZGlvIEFuYWx5emVyLgogICAgIiIiCgogICAgRU5USVRJRVMgPSBbCiAgICAgICAgIkxPQ0FUSU9OIiwKICAgICAgICAiUEVSU09OIiwKICAgICAgICAiTlJQIiwKICAgICAgICAiR1BFIiwKICAgICAgICAiT1JHQU5JWkFUSU9OIiwKICAgICAgICAiTUFDX0FERFJFU1MiLAogICAgICAgICJVU19CQU5LX05VTUJFUiIsCiAgICAgICAgIklNRUkiLAogICAgICAgICJUSVRMRSIsCiAgICAgICAgIkxJQ0VOU0VfUExBVEUiLAogICAgICAgICJVU19QQVNTUE9SVCIsCiAgICAgICAgIkNVUlJFTkNZIiwKICAgICAgICAiUk9VVElOR19OVU1CRVIiLAogICAgICAgICJVU19JVElOIiwKICAgICAgICAiVVNfQkFOS19OVU1CRVIiLAogICAgICAgICJVU19EUklWRVJfTElDRU5TRSIsCiAgICAgICAgIkFHRSIsCiAgICAgICAgIlBBU1NXT1JEIiwKICAgICAgICAiU1dJRlRfQ09ERSIsCiAgICBdCgogICAgREVGQVVMVF9FWFBMQU5BVElPTiA9ICJJZGVudGlmaWVkIGFzIHt9IGJ5IEZsYWlyJ3MgTmFtZWQgRW50aXR5IFJlY29nbml0aW9uIgoKICAgIENIRUNLX0xBQkVMX0dST1VQUyA9IFsKICAgICAgICAoeyJMT0NBVElPTiJ9LCB7IkxPQyIsICJMT0NBVElPTiIsICJTVFJFRVRfQUREUkVTUyIsICJDT09SRElOQVRFIn0pLAogICAgICAgICh7IlBFUlNPTiJ9LCB7IlBFUiIsICJQRVJTT04ifSksCiAgICAgICAgKHsiTlJQIn0sIHsiTk9SUCIsICJOUlAifSksCiAgICAgICAgKHsiR1BFIn0sIHsiR1BFIn0pLAogICAgICAgICh7Ik9SR0FOSVpBVElPTiJ9LCB7Ik9SRyJ9KSwKICAgICAgICAoeyJNQUNfQUREUkVTUyJ9LCB7Ik1BQ19BRERSRVNTIn0pLAogICAgICAgICh7IlVTX0JBTktfTlVNQkVSIn0sIHsiVVNfQkFOS19OVU1CRVIifSksCiAgICAgICAgKHsiSU1FSSJ9LCB7IklNRUkifSksCiAgICAgICAgKHsiVElUTEUifSwgeyJUSVRMRSJ9KSwKICAgICAgICAoeyJMSUNFTlNFX1BMQVRFIn0sIHsiTElDRU5TRV9QTEFURSJ9KSwKICAgICAgICAoeyJVU19QQVNTUE9SVCJ9LCB7IlVTX1BBU1NQT1JUIn0pLAogICAgICAgICh7IkNVUlJFTkNZIn0sIHsiQ1VSUkVOQ1kifSksCiAgICAgICAgKHsiUk9VVElOR19OVU1CRVIifSwgeyJST1VUSU5HX05VTUJFUiJ9KSwKICAgICAgICAoeyJBR0UifSwgeyJBR0UifSksCiAgICAgICAgKHsiQ1VSUkVOQ1kifSwgeyJDVVJSRU5DWSJ9KSwKICAgICAgICAoeyJTV0lGVF9DT0RFIn0sIHsiU1dJRlRfQ09ERSJ9KSwKICAgICAgICAoeyJVU19JVElOIn0sIHsiVVNfSVRJTiJ9KSwKICAgICAgICAoeyJVU19CQU5LX05VTUJFUiJ9LCB7IlVTX0JBTktfTlVNQkVSIn0pLAogICAgICAgICh7IlVTX0RSSVZFUl9MSUNFTlNFIn0sIHsiVVNfRFJJVkVSX0xJQ0VOU0UifSksCiAgICBdCgogICAgTU9ERUxfTEFOR1VBR0VTID0gewogICAgICAgICJlbiI6ICJiZWtpL2ZsYWlyLXBpaS1kaXN0aWxiZXJ0IiwKICAgICAgICAjICJlbiI6ImZsYWlyLXRyZi5wdCIsCiAgICB9CgogICAgUFJFU0lESU9fRVFVSVZBTEVOQ0VTID0gewogICAgICAgICJQRVIiOiAiUEVSU09OIiwKICAgICAgICAiTE9DIjogIkxPQ0FUSU9OIiwKICAgICAgICAiT1JHIjogIk9SR0FOSVpBVElPTiIsCiAgICAgICAgIk5ST1AiOiAiTlJQIiwKICAgICAgICAiVVJMIjogIlVSTCIsCiAgICAgICAgIlVTX0lUSU4iOiAiVVNfSVRJTiIsCiAgICAgICAgIlVTX1BBU1NQT1JUIjogIlVTX1BBU1NQT1JUIiwKICAgICAgICAiSUJBTl9DT0RFIjogIklCQU5fQ09ERSIsCiAgICAgICAgIklQX0FERFJFU1MiOiAiSVBfQUREUkVTUyIsCiAgICAgICAgIkVNQUlMX0FERFJFU1MiOiAiRU1BSUwiLAogICAgICAgICJVU19EUklWRVJfTElDRU5TRSI6ICJVU19EUklWRVJfTElDRU5TRSIsCiAgICAgICAgIlVTX0JBTktfTlVNQkVSIjogIlVTX0JBTktfTlVNQkVSIiwKICAgIH0KCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBzdXBwb3J0ZWRfbGFuZ3VhZ2U6IHN0ciA9ICJlbiIsCiAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzOiBPcHRpb25hbFtMaXN0W3N0cl1dID0gTm9uZSwKICAgICAgICBjaGVja19sYWJlbF9ncm91cHM6IE9wdGlvbmFsW1R1cGxlW1NldCwgU2V0XV0gPSBOb25lLAogICAgICAgIG1vZGVsOiBTZXF1ZW5jZVRhZ2dlciA9IE5vbmUsCiAgICApOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgdGhlIEZsYWlyUmVjb2duaXplci4KICAgICAgICA6cGFyYW0gc3VwcG9ydGVkX2xhbmd1YWdlOiBMYW5ndWFnZSB0byB1c2UKICAgICAgICA6cGFyYW0gc3VwcG9ydGVkX2VudGl0aWVzOiBFbnRpdGllcyB0byB1c2UKICAgICAgICA6cGFyYW0gY2hlY2tfbGFiZWxfZ3JvdXBzOiBMYWJlbCBncm91cHMgdG8gY2hlY2sKICAgICAgICA6cGFyYW0gbW9kZWw6IEZsYWlyIG1vZGVsIHRvIHVzZQogICAgICAgIDpyZXR1cm5zOiBGbGFpclJlY29nbml6ZXIgb2JqZWN0CgogICAgICAgICIiIgogICAgICAgIHNlbGYuY2hlY2tfbGFiZWxfZ3JvdXBzID0gKAogICAgICAgICAgICBjaGVja19sYWJlbF9ncm91cHMgaWYgY2hlY2tfbGFiZWxfZ3JvdXBzIGVsc2Ugc2VsZi5DSEVDS19MQUJFTF9HUk9VUFMKICAgICAgICApCgogICAgICAgIHN1cHBvcnRlZF9lbnRpdGllcyA9IHN1cHBvcnRlZF9lbnRpdGllcyBpZiBzdXBwb3J0ZWRfZW50aXRpZXMgZWxzZSBzZWxmLkVOVElUSUVTCiAgICAgICAgc2VsZi5tb2RlbCA9ICgKICAgICAgICAgICAgbW9kZWwKICAgICAgICAgICAgaWYgbW9kZWwKICAgICAgICAgICAgZWxzZSBTZXF1ZW5jZVRhZ2dlci5sb2FkKHNlbGYuTU9ERUxfTEFOR1VBR0VTLmdldChzdXBwb3J0ZWRfbGFuZ3VhZ2UpKQogICAgICAgICkKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygKICAgICAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzPXN1cHBvcnRlZF9lbnRpdGllcywKICAgICAgICAgICAgc3VwcG9ydGVkX2xhbmd1YWdlPXN1cHBvcnRlZF9sYW5ndWFnZSwKICAgICAgICAgICAgbmFtZT0iRmxhaXIgQW5hbHl0aWNzIiwKICAgICAgICApCgogICAgZGVmIGxvYWQoc2VsZikgLT4gTm9uZToKICAgICAgICAiIiJMb2FkIHRoZSBtb2RlbCwgbm90IHVzZWQuIE1vZGVsIGlzIGxvYWRlZCBkdXJpbmcgaW5pdGlhbGl6YXRpb24uIiIiCiAgICAgICAgcGFzcwoKICAgIGRlZiBnZXRfc3VwcG9ydGVkX2VudGl0aWVzKHNlbGYpIC0+IExpc3Rbc3RyXToKICAgICAgICAiIiIKICAgICAgICBSZXR1cm4gc3VwcG9ydGVkIGVudGl0aWVzIGJ5IHRoaXMgbW9kZWwuCiAgICAgICAgOnJldHVybnM6IExpc3Qgb2YgdGhlIHN1cHBvcnRlZCBlbnRpdGllcy4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5zdXBwb3J0ZWRfZW50aXRpZXMKCiAgICAjIENsYXNzIHRvIHVzZSBGbGFpciB3aXRoIFByZXNpZGlvIGFzIGFuIGV4dGVybmFsIHJlY29nbml6ZXIuCiAgICBkZWYgYW5hbHl6ZSgKICAgICAgICBzZWxmLCB0ZXh0OiBzdHIsIGVudGl0aWVzOiBMaXN0W3N0cl0sIG5scF9hcnRpZmFjdHM6IE5scEFydGlmYWN0cyA9IE5vbmUKICAgICkgLT4gTGlzdFtSZWNvZ25pemVyUmVzdWx0XToKICAgICAgICAiIiIKICAgICAgICBBbmFseXplIHRleHQgdXNpbmcgVGV4dCBBbmFseXRpY3MuCiAgICAgICAgOnBhcmFtIHRleHQ6IFRoZSB0ZXh0IGZvciBhbmFseXNpcy4KICAgICAgICA6cGFyYW0gZW50aXRpZXM6IE5vdCB3b3JraW5nIHByb3Blcmx5IGZvciB0aGlzIHJlY29nbml6ZXIuCiAgICAgICAgOnBhcmFtIG5scF9hcnRpZmFjdHM6IE5vdCB1c2VkIGJ5IHRoaXMgcmVjb2duaXplci4KICAgICAgICA6cGFyYW0gbGFuZ3VhZ2U6IFRleHQgbGFuZ3VhZ2UuIFN1cHBvcnRlZCBsYW5ndWFnZXMgaW4gTU9ERUxfTEFOR1VBR0VTCiAgICAgICAgOnJldHVybnM6IFRoZSBsaXN0IG9mIFByZXNpZGlvIFJlY29nbml6ZXJSZXN1bHQgY29uc3RydWN0ZWQgZnJvbSB0aGUgcmVjb2duaXplZAogICAgICAgICAgICBGbGFpciBkZXRlY3Rpb25zLgogICAgICAgICIiIgoKICAgICAgICByZXN1bHRzID0gW10KCiAgICAgICAgc2VudGVuY2VzID0gU2VudGVuY2UodGV4dCkKICAgICAgICBzZWxmLm1vZGVsLnByZWRpY3Qoc2VudGVuY2VzKQoKICAgICAgICAjIElmIHRoZXJlIGFyZSBubyBzcGVjaWZpYyBsaXN0IG9mIGVudGl0aWVzLCB3ZSB3aWxsIGxvb2sgZm9yIGFsbCBvZiBpdC4KICAgICAgICBpZiBub3QgZW50aXRpZXM6CiAgICAgICAgICAgIGVudGl0aWVzID0gc2VsZi5zdXBwb3J0ZWRfZW50aXRpZXMKCiAgICAgICAgZm9yIGVudGl0eSBpbiBlbnRpdGllczoKICAgICAgICAgICAgaWYgZW50aXR5IG5vdCBpbiBzZWxmLnN1cHBvcnRlZF9lbnRpdGllczoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBmb3IgZW50IGluIHNlbnRlbmNlcy5nZXRfc3BhbnMoIm5lciIpOgogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX19jaGVja19sYWJlbCgKICAgICAgICAgICAgICAgICAgICBlbnRpdHksIGVudC5sYWJlbHNbMF0udmFsdWUsIHNlbGYuY2hlY2tfbGFiZWxfZ3JvdXBzCiAgICAgICAgICAgICAgICApOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB0ZXh0dWFsX2V4cGxhbmF0aW9uID0gc2VsZi5ERUZBVUxUX0VYUExBTkFUSU9OLmZvcm1hdCgKICAgICAgICAgICAgICAgICAgICBlbnQubGFiZWxzWzBdLnZhbHVlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBleHBsYW5hdGlvbiA9IHNlbGYuYnVpbGRfZmxhaXJfZXhwbGFuYXRpb24oCiAgICAgICAgICAgICAgICAgICAgcm91bmQoZW50LnNjb3JlLCAyKSwgdGV4dHVhbF9leHBsYW5hdGlvbgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZmxhaXJfcmVzdWx0ID0gc2VsZi5fY29udmVydF90b19yZWNvZ25pemVyX3Jlc3VsdChlbnQsIGV4cGxhbmF0aW9uKQoKICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKGZsYWlyX3Jlc3VsdCkKCiAgICAgICAgcmV0dXJuIHJlc3VsdHMKCiAgICBkZWYgX2NvbnZlcnRfdG9fcmVjb2duaXplcl9yZXN1bHQoc2VsZiwgZW50aXR5LCBleHBsYW5hdGlvbikgLT4gUmVjb2duaXplclJlc3VsdDoKICAgICAgICAiIiIKICAgICAgICBDb252ZXJ0IEZsYWlyIHJlc3VsdCB0byBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0LgogICAgICAgIDpwYXJhbSBlbnRpdHk6IEZsYWlyIGVudGl0eQogICAgICAgIDpwYXJhbSBleHBsYW5hdGlvbjogQW5hbHlzaXNFeHBsYW5hdGlvbgogICAgICAgIDpyZXR1cm5zOiBSZWNvZ25pemVyUmVzdWx0CiAgICAgICAgIiIiCiAgICAgICAgZW50aXR5X3R5cGUgPSBzZWxmLlBSRVNJRElPX0VRVUlWQUxFTkNFUy5nZXQoZW50aXR5LnRhZywgZW50aXR5LnRhZykKICAgICAgICBmbGFpcl9zY29yZSA9IHJvdW5kKGVudGl0eS5zY29yZSwgMikKCiAgICAgICAgZmxhaXJfcmVzdWx0cyA9IFJlY29nbml6ZXJSZXN1bHQoCiAgICAgICAgICAgIGVudGl0eV90eXBlPWVudGl0eV90eXBlLAogICAgICAgICAgICBzdGFydD1lbnRpdHkuc3RhcnRfcG9zaXRpb24sCiAgICAgICAgICAgIGVuZD1lbnRpdHkuZW5kX3Bvc2l0aW9uLAogICAgICAgICAgICBzY29yZT1mbGFpcl9zY29yZSwKICAgICAgICAgICAgYW5hbHlzaXNfZXhwbGFuYXRpb249ZXhwbGFuYXRpb24sCiAgICAgICAgKQoKICAgICAgICByZXR1cm4gZmxhaXJfcmVzdWx0cwoKICAgIGRlZiBidWlsZF9mbGFpcl9leHBsYW5hdGlvbigKICAgICAgICBzZWxmLCBvcmlnaW5hbF9zY29yZTogZmxvYXQsIGV4cGxhbmF0aW9uOiBzdHIKICAgICkgLT4gQW5hbHlzaXNFeHBsYW5hdGlvbjoKICAgICAgICAiIiIKICAgICAgICBDcmVhdGUgZXhwbGFuYXRpb24gZm9yIHdoeSB0aGlzIHJlc3VsdCB3YXMgZGV0ZWN0ZWQuCiAgICAgICAgOnBhcmFtIG9yaWdpbmFsX3Njb3JlOiBTY29yZSBnaXZlbiBieSB0aGlzIHJlY29nbml6ZXIKICAgICAgICA6cGFyYW0gZXhwbGFuYXRpb246IEV4cGxhbmF0aW9uIHN0cmluZwogICAgICAgIDpyZXR1cm5zOiBBbmFseXNpc0V4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgZXhwbGFuYXRpb24gPSBBbmFseXNpc0V4cGxhbmF0aW9uKAogICAgICAgICAgICByZWNvZ25pemVyPXNlbGYuX19jbGFzc19fLl9fbmFtZV9fLAogICAgICAgICAgICBvcmlnaW5hbF9zY29yZT1vcmlnaW5hbF9zY29yZSwKICAgICAgICAgICAgdGV4dHVhbF9leHBsYW5hdGlvbj1leHBsYW5hdGlvbiwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGV4cGxhbmF0aW9uCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIF9fY2hlY2tfbGFiZWwoCiAgICAgICAgZW50aXR5OiBzdHIsIGxhYmVsOiBzdHIsIGNoZWNrX2xhYmVsX2dyb3VwczogVHVwbGVbU2V0LCBTZXRdCiAgICApIC0+IGJvb2w6CiAgICAgICAgcmV0dXJuIGFueSgKICAgICAgICAgICAgW2VudGl0eSBpbiBlZ3JwIGFuZCBsYWJlbCBpbiBsZ3JwIGZvciBlZ3JwLCBsZ3JwIGluIGNoZWNrX2xhYmVsX2dyb3Vwc10KICAgICAgICApCgoKZGVmIGFuYWx5emVyX2VuZ2luZShtb2RlbD0id2hvbGUiKToKICAgICIiIlJldHVybiBBbmFseXplckVuZ2luZS4KICAgIDpwYXJhbSBtb2RlbDogVGhlIG1vZGVsIHRvIHVzZS4gQ2FuIGJlICJzcGFjeSIsICJmbGFpciIsICJwYXR0ZXJuIiBvciAid2hvbGUiLgogICAgOnJldHVybnM6IEFuYWx5emVyRW5naW5lCiAgICAiIiIKICAgIHJlZ2lzdHJ5ID0gUmVjb2duaXplclJlZ2lzdHJ5KCkKCiAgICBzcGFjeV9yZWNvZ25pemVyID0gQ3VzdG9tU3BhY3lSZWNvZ25pemVyKCkKCiAgICBmbGFpcl9yZWNvZ25pemVyID0gRmxhaXJSZWNvZ25pemVyKCkKCiAgICBpZiBtb2RlbCA9PSAic3BhY3kiOgogICAgICAgICMgYWRkIHRoZSBjdXN0b20gYnVpbGQgc3BhY3kgcmVjb2duaXplcgogICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKHNwYWN5X3JlY29nbml6ZXIpCiAgICBpZiBtb2RlbCA9PSAiZmxhaXIiOgogICAgICAgICMgYWRkIHRoZSBjdXN0b20gYnVpbGQgZmxhaXIgcmVjb2duaXplcgogICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKGZsYWlyX3JlY29nbml6ZXIpCiAgICBpZiBtb2RlbCA9PSAicGF0dGVybiI6CiAgICAgICAgIyBhZGQgdGhlIHBhdHRlcm4gcmVjb2duaXplcgogICAgICAgIHBhdHRlcm5fcmVjb2duaXplcl9mYWN0b3J5ID0gUGF0dGVyblJlY29nbml6ZXJGYWN0b3J5KCkKICAgICAgICBmb3IgcmVjb2duaXplciBpbiBwYXR0ZXJuX3JlY29nbml6ZXJfZmFjdG9yeS5jcmVhdGVfcGF0dGVybl9yZWNvZ25pemVyKCk6CiAgICAgICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKHJlY29nbml6ZXIpCiAgICBpZiBtb2RlbCA9PSAid2hvbGUiOgogICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKHNwYWN5X3JlY29nbml6ZXIpCiAgICAgICAgcmVnaXN0cnkuYWRkX3JlY29nbml6ZXIoZmxhaXJfcmVjb2duaXplcikKICAgICAgICAjIGFkZCB0aGUgcGF0dGVybiByZWNvZ25pemVyCiAgICAgICAgcGF0dGVybl9yZWNvZ25pemVyX2ZhY3RvcnkgPSBQYXR0ZXJuUmVjb2duaXplckZhY3RvcnkoKQogICAgICAgIGZvciByZWNvZ25pemVyIGluIHBhdHRlcm5fcmVjb2duaXplcl9mYWN0b3J5LmNyZWF0ZV9wYXR0ZXJuX3JlY29nbml6ZXIoKToKICAgICAgICAgICAgcmVnaXN0cnkuYWRkX3JlY29nbml6ZXIocmVjb2duaXplcikKCiAgICBhbmFseXplciA9IEFuYWx5emVyRW5naW5lKHJlZ2lzdHJ5PXJlZ2lzdHJ5LCBzdXBwb3J0ZWRfbGFuZ3VhZ2VzPVsiZW4iXSkKICAgIHJldHVybiBhbmFseXplcgoKCmRlZiBhbm9ueW1pemVyX2VuZ2luZSgpOgogICAgIiIiUmV0dXJuIEFub255bWl6ZXJFbmdpbmUuCiAgICA6cmV0dXJuczogVGhlIEFub255bWl6ZXJFbmdpbmUuCiAgICAiIiIKICAgIHJldHVybiBBbm9ueW1pemVyRW5naW5lKCkKCgpkZWYgZ2V0X3N1cHBvcnRlZF9lbnRpdGllcygpOgogICAgIiIiUmV0dXJuIHN1cHBvcnRlZCBlbnRpdGllcyBmcm9tIHRoZSBBbmFseXplciBFbmdpbmUuCiAgICA6cmV0dXJuczogVGhlIGxpc3Qgb2Ygc3VwcG9ydGVkIGVudGl0aWVzLgogICAgIiIiCiAgICByZXR1cm4gYW5hbHl6ZXJfZW5naW5lKCkuZ2V0X3N1cHBvcnRlZF9lbnRpdGllcygpCgoKZGVmIGFuYWx5emUoKiprd2FyZ3MpOgogICAgIiIiQW5hbHl6ZSBpbnB1dCB1c2luZyBBbmFseXplciBlbmdpbmUgYW5kIGlucHV0IGFyZ3VtZW50cyAoa3dhcmdzKS4KICAgIDpwYXJhbSBrd2FyZ3M6IFRoZSBpbnB1dCBhcmd1bWVudHMgZm9yIHRoZSBhbmFseXplciBlbmdpbmUuCiAgICA6cmV0dXJuczogVGhlIGxpc3Qgb2YgUHJlc2lkaW8gUmVjb2duaXplclJlc3VsdCBjb25zdHJ1Y3RlZCBmcm9tIHRoZSByZWNvZ25pemVkCiAgICAiIiIKICAgIGlmICJlbnRpdGllcyIgbm90IGluIGt3YXJncyBvciAiQWxsIiBpbiBrd2FyZ3NbImVudGl0aWVzIl06CiAgICAgICAga3dhcmdzWyJlbnRpdGllcyJdID0gTm9uZQogICAgcmV0dXJuIGFuYWx5emVyX2VuZ2luZSgpLmFuYWx5emUoKiprd2FyZ3MpCgoKZGVmIGFub255bWl6ZSh0ZXh0LCBhbmFseXplX3Jlc3VsdHMpOgogICAgIiIiQW5vbnltaXplIGlkZW50aWZpZWQgaW5wdXQgdXNpbmcgUHJlc2lkaW8gQWJvbnltaXplci4KICAgIDpwYXJhbSB0ZXh0OiBUaGUgdGV4dCBmb3IgYW5hbHlzaXMuCiAgICA6cGFyYW0gYW5hbHl6ZV9yZXN1bHRzOiBUaGUgbGlzdCBvZiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGNvbnN0cnVjdGVkIGZyb20KICAgIDpyZXR1cm5zOiBUaGUgYW5vbnltaXplZCB0ZXh0LgogICAgIiIiCiAgICBpZiBub3QgdGV4dDoKICAgICAgICByZXR1cm4KICAgIHJlcyA9IGFub255bWl6ZXJfZW5naW5lKCkuYW5vbnltaXplKHRleHQsIGFuYWx5emVfcmVzdWx0cykKICAgIHJldHVybiByZXMudGV4dAoKCmRlZiBhbm5vdGF0ZSh0ZXh0LCBzdF9hbmFseXplX3Jlc3VsdHMsIHN0X2VudGl0aWVzKToKICAgICIiIkFubm90YXRlIGlkZW50aWZpZWQgaW5wdXQgdXNpbmcgUHJlc2lkaW8gQW5vbnltaXplci4KICAgIDpwYXJhbSB0ZXh0OiBUaGUgdGV4dCBmb3IgYW5hbHlzaXMuCiAgICA6cGFyYW0gc3RfYW5hbHl6ZV9yZXN1bHRzOiBUaGUgbGlzdCBvZiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGNvbnN0cnVjdGVkIGZyb20KICAgIDpyZXR1cm5zOiBUaGUgbGlzdCBvZiB0b2tlbnMgd2l0aCB0aGUgaWRlbnRpZmllZCBlbnRpdGllcy4KCiAgICAiIiIKICAgIHRva2VucyA9IFtdCiAgICAjIHNvcnQgYnkgc3RhcnQgaW5kZXgKICAgIHJlc3VsdHMgPSBzb3J0ZWQoc3RfYW5hbHl6ZV9yZXN1bHRzLCBrZXk9bGFtYmRhIHg6IHguc3RhcnQpCiAgICBmb3IgaSwgcmVzIGluIGVudW1lcmF0ZShyZXN1bHRzKToKICAgICAgICBpZiBpID09IDA6CiAgICAgICAgICAgIHRva2Vucy5hcHBlbmQodGV4dFs6IHJlcy5zdGFydF0pCgogICAgICAgICMgYXBwZW5kIGVudGl0eSB0ZXh0IGFuZCBlbnRpdHkgdHlwZQogICAgICAgIHRva2Vucy5hcHBlbmQoKHRleHRbcmVzLnN0YXJ0IDogcmVzLmVuZF0sIHJlcy5lbnRpdHlfdHlwZSkpCgogICAgICAgICMgaWYgYW5vdGhlciBlbnRpdHkgY29taW5nIGkuZS4gd2UncmUgbm90IGF0IHRoZSBsYXN0IHJlc3VsdHMgZWxlbWVudCwKICAgICAgICAjIGFkZCB0ZXh0IHVwIHRvIG5leHQgZW50aXR5CiAgICAgICAgaWYgaSAhPSBsZW4ocmVzdWx0cykgLSAxOgogICAgICAgICAgICB0b2tlbnMuYXBwZW5kKHRleHRbcmVzLmVuZCA6IHJlc3VsdHNbaSArIDFdLnN0YXJ0XSkKICAgICAgICAjIGlmIG5vIG1vcmUgZW50aXRpZXMgY29taW5nLCBhZGQgYWxsIHJlbWFpbmluZyB0ZXh0CiAgICAgICAgZWxzZToKICAgICAgICAgICAgdG9rZW5zLmFwcGVuZCh0ZXh0W3Jlcy5lbmQgOl0pCiAgICByZXR1cm4gdG9rZW5zCgoKY2xhc3MgQ3VzdG9tRW5jb2RlcihKU09ORW5jb2Rlcik6CiAgICAiIiJDdXN0b20gZW5jb2RlciBmb3IgSlNPTkVuY29kZXIuCiAgICA6cGFyYW0gSlNPTkVuY29kZXI6IFRoZSBKU09ORW5jb2Rlci4KICAgIDpyZXR1cm5zOiBUaGUgSlNPTkVuY29kZXIuCiAgICAiIiIKCiAgICBkZWYgZGVmYXVsdChzZWxmLCBvKToKICAgICAgICByZXR1cm4gby5fX2RpY3RfXwoKCkBtbHJ1bi5oYW5kbGVyKG5hbWU9InByb2Nlc3MiKQpkZWYgcHJvY2VzcyhpbnB1dF9maWxlLCBvdXRwdXRfZmlsZSwgbW9kZWwpOgogICAgIiIiCiAgICBQcm9jZXNzIHRoZSBpbnB1dCBmaWxlIGFuZCBnZW5lcmF0ZSB0aGUgb3V0cHV0IGZpbGUuCgogICAgOnBhcmFtIGlucHV0X2ZpbGU6IElucHV0IGZpbGUgcGF0aAogICAgOnBhcmFtIG91dHB1dF9maWxlOiBPdXRwdXQgZmlsZSBwYXRoCiAgICA6cGFyYW0gbW9kZWw6IE1vZGVsIHRvIHVzZSBmb3IgcHJvY2Vzc2luZwogICAgIiIiCiAgICBhbmFseXplciA9IGFuYWx5emVyX2VuZ2luZShtb2RlbCkKICAgIHdpdGggb3BlbihpbnB1dF9maWxlLCAiciIpIGFzIGY6CiAgICAgICAgdGV4dCA9IGYucmVhZCgpCiAgICAgICAgcmVzdWx0cyA9IGFuYWx5emVyLmFuYWx5emUoCiAgICAgICAgICAgIHRleHQ9dGV4dCwKICAgICAgICAgICAgbGFuZ3VhZ2U9ImVuIiwKICAgICAgICAgICAgZW50aXRpZXM9Z2V0X3N1cHBvcnRlZF9lbnRpdGllcygpLAogICAgICAgICAgICByZXR1cm5fZGVjaXNpb25fcHJvY2Vzcz1UcnVlLAogICAgICAgICkKICAgICAgICBhbm9ueW1pemVkX3RleHQgPSBhbm9ueW1pemUodGV4dCwgcmVzdWx0cykKCiAgICB3aXRoIG9wZW4ob3V0cHV0X2ZpbGUsICJ3IikgYXMgZjoKICAgICAgICBmLndyaXRlKGFub255bWl6ZWRfdGV4dCkKICAgIGFubm90YXRlZF90b2tlbnMgPSBhbm5vdGF0ZSh0ZXh0LCByZXN1bHRzLCBnZXRfc3VwcG9ydGVkX2VudGl0aWVzKCkpCiAgICBodG1sID0gZ2V0X2Fubm90YXRlZF9odG1sKCphbm5vdGF0ZWRfdG9rZW5zKQogICAgd2l0aCBvcGVuKG91dHB1dF9maWxlWzotNF0gKyAiLmh0bWwiLCAidyIpIGFzIGY6CiAgICAgICAgZi53cml0ZSgKICAgICAgICAgICAgZiI8aHRtbD48Ym9keT48cD57aHRtbC5yZXBsYWNlKCd7YmFja3NsYXNoX2NoYXJ9bicsICc8YnI+Jyl9PC9wPjwvYm9keT48L2h0bWw+IgogICAgICAgICkKICAgIHN0YXRzID0gcmVzdWx0cwogICAgd2l0aCBvcGVuKGYie291dHB1dF9maWxlWzotNF19X3N0YXRzLmpzb24iLCAidyIpIGFzIGY6CiAgICAgICAganNvbi5kdW1wKHN0YXRzLCBmLCBjbHM9Q3VzdG9tRW5jb2RlcikK
    commands: []
    code_origin: git@github.com-personal:pengwei715/pii_masker.git#af062bd4ad903ddb2eba5e56c1a136e1d1287cec:pii_recognizer.py
    origin_filename: pii_recognizer.py
  entry_points:
    create_pattern_recognizer:
      name: create_pattern_recognizer
      doc: ''
      parameters: []
      outputs:
      - default: ''
      lineno: 44
    load:
      name: load
      doc: Load the model, not used. Model is loaded during initialization.
      parameters:
      - name: self
        default: ''
      outputs:
      - default: ''
      lineno: 297
    get_supported_entities:
      name: get_supported_entities
      doc: Return supported entities from the Analyzer Engine.
      parameters: []
      outputs:
      - default: ''
        doc: The list of supported entities.
      lineno: 438
    build_spacy_explanation:
      name: build_spacy_explanation
      doc: Create explanation for why this result was detected.
      parameters:
      - name: self
        default: ''
      - name: original_score
        type: float
        doc: Score given by this recognizer
        default: ''
      - name: explanation
        type: str
        doc: Explanation string
        default: ''
      outputs:
      - default: ''
        doc: AnalysisExplanation object
        type: AnalysisExplanation
      lineno: 122
    analyze:
      name: analyze
      doc: Analyze input using Analyzer engine and input arguments (kwargs).
      parameters: []
      outputs:
      - default: ''
        doc: The list of Presidio RecognizerResult constructed from the recognized
      lineno: 445
    build_flair_explanation:
      name: build_flair_explanation
      doc: Create explanation for why this result was detected.
      parameters:
      - name: self
        default: ''
      - name: original_score
        type: float
        doc: Score given by this recognizer
        default: ''
      - name: explanation
        type: str
        doc: Explanation string
        default: ''
      outputs:
      - default: ''
        doc: AnalysisExplanation
        type: AnalysisExplanation
      lineno: 372
    analyzer_engine:
      name: analyzer_engine
      doc: Return AnalyzerEngine.
      parameters:
      - name: model
        doc: The model to use. Can be "spacy", "flair", "pattern" or "whole".
        default: whole
      outputs:
      - default: ''
        doc: AnalyzerEngine
      lineno: 397
    anonymizer_engine:
      name: anonymizer_engine
      doc: Return AnonymizerEngine.
      parameters: []
      outputs:
      - default: ''
        doc: The AnonymizerEngine.
      lineno: 431
    anonymize:
      name: anonymize
      doc: Anonymize identified input using Presidio Abonymizer.
      parameters:
      - name: text
        doc: The text for analysis.
        default: ''
      - name: analyze_results
        doc: The list of Presidio RecognizerResult constructed from
        default: ''
      outputs:
      - default: ''
        doc: The anonymized text.
      lineno: 455
    annotate:
      name: annotate
      doc: Annotate identified input using Presidio Anonymizer.
      parameters:
      - name: text
        doc: The text for analysis.
        default: ''
      - name: st_analyze_results
        doc: The list of Presidio RecognizerResult constructed from
        default: ''
      - name: st_entities
        default: ''
      outputs:
      - default: ''
        doc: The list of tokens with the identified entities.
      lineno: 467
    default:
      name: default
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: o
        default: ''
      outputs:
      - default: ''
      lineno: 500
    process:
      name: process
      doc: Process the input file and generate the output file.
      parameters:
      - name: input_file
        doc: Input file path
        default: ''
      - name: output_file
        doc: Output file path
        default: ''
      - name: model
        doc: Model to use for processing
        default: ''
      outputs:
      - default: ''
      lineno: 505
  description: This function is used to recognize PII in a given text
  default_handler: process
  disable_auto_mount: false
  env: []
  resources:
    requests:
      memory: 1Mi
      cpu: 25m
    limits:
      memory: 20Gi
      cpu: '2'
  priority_class_name: igz-workload-medium
  preemption_mode: prevent
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: app.iguazio.com/lifecycle
            operator: NotIn
            values:
            - preemptible
          - key: eks.amazonaws.com/capacityType
            operator: NotIn
            values:
            - SPOT
          - key: node-lifecycle
            operator: NotIn
            values:
            - spot
  tolerations: null
  security_context: {}
verbose: false
