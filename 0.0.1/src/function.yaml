kind: job
metadata:
  name: pii-recognizer
  tag: ''
  hash: 5902a36fca44c6714eae41c055f2dafdaa8822ec
  project: default
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  build:
    functionSourceCode: ZnJvbSBwcmVzaWRpb19hbm9ueW1pemVyIGltcG9ydCBBbm9ueW1pemVyRW5naW5lCmZyb20gYW5ub3RhdGVkX3RleHQudXRpbCBpbXBvcnQgZ2V0X2Fubm90YXRlZF9odG1sCmZyb20ganNvbiBpbXBvcnQgSlNPTkVuY29kZXIKaW1wb3J0IGpzb24KaW1wb3J0IHdhcm5pbmdzCmltcG9ydCBvcwppbXBvcnQgbG9nZ2luZwpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIExpc3QsIFR1cGxlLCBTZXQKCmZyb20gcHJlc2lkaW9fYW5hbHl6ZXIgaW1wb3J0ICgKICAgIFJlY29nbml6ZXJSZWdpc3RyeSwKICAgIEFuYWx5emVyRW5naW5lLAogICAgUmVjb2duaXplclJlc3VsdCwKICAgIExvY2FsUmVjb2duaXplciwKICAgIEVudGl0eVJlY29nbml6ZXIsCiAgICBQYXR0ZXJuLAogICAgUGF0dGVybl9SZWNvZ25pemVyLAogICAgQW5hbHlzaXNFeHBsYW5hdGlvbiwKKQpmcm9tIHByZXNpZGlvX2FuYWx5emVyLm5scF9lbmdpbmUgaW1wb3J0IE5scEFydGlmYWN0cwpmcm9tIHByZXNpZGlvX2FuYWx5emVyLnByZWRlZmluZWRfcmVjb2duaXplcnMuc3BhY3lfcmVjb2duaXplciBpbXBvcnQgU3BhY3lSZWNvZ25pemVyCgp0cnk6CiAgICBmcm9tIGZsYWlyLmRhdGEgaW1wb3J0IFNlbnRlbmNlCiAgICBmcm9tIGZsYWlyLm1vZGVscyBpbXBvcnQgU2VxdWVuY2VUYWdnZXIKZXhjZXB0IEltcG9ydEVycm9yOgogICAgcHJpbnQoIkZsYWlyIGlzIG5vdCBpbnN0YWxsZWQiKQoKb3MuZW52aXJvblsiVE9LRU5JWkVSU19QQVJBTExFTElTTSJdID0gImZhbHNlIgp3YXJuaW5ncy5maWx0ZXJ3YXJuaW5ncygiaWdub3JlIikKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoInBpaS1yZWNvZ25pemVyIikKCgpjbGFzcyBQYXR0ZXJuUmVjb2duaXplckZhY3Rvcnk6CiAgICBFTlRJVElFUyA9IHsKICAgICAgICAiQ1JFRElUX0NBUkQiOiBbUGF0dGVybigiQ1JFRElUX0NBUkQiLCByIlxiKD86XGRbIC1dKj8pezEzLDE2fVxiIiwgMC41KV0sCiAgICAgICAgIlNTTiI6IFtQYXR0ZXJuKCJTU04iLCByIlxiXGR7M30tP1xkezJ9LT9cZHs0fVxiIiwgMC41KV0sCiAgICAgICAgIlBIT05FIjogW1BhdHRlcm4oIlBIT05FIiwgciJcKD9cZHszfVwpP1stLlxzXT9cZHszfVstLlxzXT9cZHs0fSIsIDAuNSldLAogICAgICAgICJFTUFJTCI6IFtQYXR0ZXJuKCJFTUFJTCIsIHIiXFMrQFxTKyIsIDAuNSldLAogICAgfQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBjcmVhdGVfcGF0dGVybl9yZWNvZ25pemVyKCk6CiAgICAgICAgcmVzID0gW10KICAgICAgICBmb3IgZW50aXR5LCBwYXR0ZXJuIGluIHNlbGYuRU5USVRJRVMuaXRlbXMoKToKICAgICAgICAgICAgcmVzLmFwcGVuZChQYXR0ZXJuUmVjb2duaXplcihzdXBwb3J0ZWRfZW50aXR5PWVudGl0eSwgcGF0dGVybnM9cGF0dGVybikpCiAgICAgICAgcmV0dXJuIHJlcwoKCmNsYXNzIEN1c3RvbVNwYWN5UmVjb2duaXplcihMb2NhbFJlY29nbml6ZXIpOgogICAgRU5USVRJRVMgPSBbCiAgICAgICAgIkxPQ0FUSU9OIiwKICAgICAgICAiUEVSU09OIiwKICAgICAgICAiTlJQIiwKICAgICAgICAiT1JHQU5JWkFUSU9OIiwKICAgICAgICAiREFURV9USU1FIiwKICAgIF0KCiAgICBERUZBVUxUX0VYUExBTkFUSU9OID0gKAogICAgICAgICJJZGVudGlmaWVkIGFzIHt9IGJ5IFNwYWN5J3MgTmFtZWQgRW50aXR5IFJlY29nbml0aW9uIChQcml2eS10cmFpbmVkKSIKICAgICkKCiAgICBDSEVDS19MQUJFTF9HUk9VUFMgPSBbCiAgICAgICAgKHsiTE9DQVRJT04ifSwgeyJMT0MiLCAiTE9DQVRJT04iLCAiU1RSRUVUX0FERFJFU1MiLCAiQ09PUkRJTkFURSJ9KSwKICAgICAgICAoeyJQRVJTT04ifSwgeyJQRVIiLCAiUEVSU09OIn0pLAogICAgICAgICh7Ik5SUCJ9LCB7Ik5PUlAiLCAiTlJQIn0pLAogICAgICAgICh7Ik9SR0FOSVpBVElPTiJ9LCB7Ik9SRyJ9KSwKICAgICAgICAoeyJEQVRFX1RJTUUifSwgeyJEQVRFX1RJTUUifSksCiAgICBdCgogICAgTU9ERUxfTEFOR1VBR0VTID0gewogICAgICAgICJlbiI6ICJiZWtpL2VuX3NwYWN5X3BpaV9kaXN0aWxiZXJ0IiwKICAgIH0KCiAgICBQUkVTSURJT19FUVVJVkFMRU5DRVMgPSB7CiAgICAgICAgIlBFUiI6ICJQRVJTT04iLAogICAgICAgICJMT0MiOiAiTE9DQVRJT04iLAogICAgICAgICJPUkciOiAiT1JHQU5JWkFUSU9OIiwKICAgICAgICAiTlJPUCI6ICJOUlAiLAogICAgICAgICJEQVRFX1RJTUUiOiAiREFURV9USU1FIiwKICAgIH0KCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBzdXBwb3J0ZWRfbGFuZ3VhZ2U6IHN0ciA9ICJlbiIsCiAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzOiBPcHRpb25hbFtMaXN0W3N0cl1dID0gTm9uZSwKICAgICAgICBjaGVja19sYWJlbF9ncm91cHM6IE9wdGlvbmFsW1R1cGxlW1NldCwgU2V0XV0gPSBOb25lLAogICAgICAgIGNvbnRleHQ6IE9wdGlvbmFsW0xpc3Rbc3RyXV0gPSBOb25lLAogICAgICAgIG5lcl9zdHJlbmd0aDogZmxvYXQgPSAwLjg1LAogICAgKToKICAgICAgICAiIiIKICAgICAgICBJbml0aWFsaXplIFNwYWN5IFJlY29nbml6ZXIuCiAgICAgICAgOnBhcmFtIHN1cHBvcnRlZF9sYW5ndWFnZTogTGFuZ3VhZ2UgdG8gdXNlCiAgICAgICAgOnBhcmFtIHN1cHBvcnRlZF9lbnRpdGllczogRW50aXRpZXMgdG8gdXNlCiAgICAgICAgOnBhcmFtIGNoZWNrX2xhYmVsX2dyb3VwczogTGFiZWwgZ3JvdXBzIHRvIGNoZWNrCiAgICAgICAgOnBhcmFtIGNvbnRleHQ6IENvbnRleHQgdG8gdXNlCiAgICAgICAgOnBhcmFtIG5lcl9zdHJlbmd0aDogTkVSIHN0cmVuZ3RoIHRvIHVzZQogICAgICAgIDpyZXR1cm5zIFNwYWN5UmVjb2duaXplciBvYmplY3QKICAgICAgICAiIiIKICAgICAgICBzZWxmLm5lcl9zdHJlbmd0aCA9IG5lcl9zdHJlbmd0aAogICAgICAgIHNlbGYuY2hlY2tfbGFiZWxfZ3JvdXBzID0gKAogICAgICAgICAgICBjaGVja19sYWJlbF9ncm91cHMgaWYgY2hlY2tfbGFiZWxfZ3JvdXBzIGVsc2Ugc2VsZi5DSEVDS19MQUJFTF9HUk9VUFMKICAgICAgICApCiAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzID0gc3VwcG9ydGVkX2VudGl0aWVzIGlmIHN1cHBvcnRlZF9lbnRpdGllcyBlbHNlIHNlbGYuRU5USVRJRVMKICAgICAgICBzdXBlcigpLl9faW5pdF9fKAogICAgICAgICAgICBzdXBwb3J0ZWRfZW50aXRpZXM9c3VwcG9ydGVkX2VudGl0aWVzLAogICAgICAgICAgICBzdXBwb3J0ZWRfbGFuZ3VhZ2U9c3VwcG9ydGVkX2xhbmd1YWdlLAogICAgICAgICkKCiAgICBkZWYgbG9hZChzZWxmKSAtPiBOb25lOgogICAgICAgICIiIkxvYWQgdGhlIG1vZGVsLCBub3QgdXNlZC4gTW9kZWwgaXMgbG9hZGVkIGR1cmluZyBpbml0aWFsaXphdGlvbi4iIiIKICAgICAgICBwYXNzCgogICAgZGVmIGdldF9zdXBwb3J0ZWRfZW50aXRpZXMoc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIFJldHVybiBzdXBwb3J0ZWQgZW50aXRpZXMgYnkgdGhpcyBtb2RlbC4KICAgICAgICA6cmV0dXJucyBMaXN0IG9mIHRoZSBzdXBwb3J0ZWQgZW50aXRpZXMuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuc3VwcG9ydGVkX2VudGl0aWVzCgogICAgZGVmIGJ1aWxkX3NwYWN5X2V4cGxhbmF0aW9uKAogICAgICAgIHNlbGYsIG9yaWdpbmFsX3Njb3JlOiBmbG9hdCwgZXhwbGFuYXRpb246IHN0cgogICAgKSAtPiBBbmFseXNpc0V4cGxhbmF0aW9uOgogICAgICAgICIiIgogICAgICAgIENyZWF0ZSBleHBsYW5hdGlvbiBmb3Igd2h5IHRoaXMgcmVzdWx0IHdhcyBkZXRlY3RlZC4KICAgICAgICA6cGFyYW0gb3JpZ2luYWxfc2NvcmU6IFNjb3JlIGdpdmVuIGJ5IHRoaXMgcmVjb2duaXplcgogICAgICAgIDpwYXJhbSBleHBsYW5hdGlvbjogRXhwbGFuYXRpb24gc3RyaW5nCiAgICAgICAgOnJldHVybnM6IEFuYWx5c2lzRXhwbGFuYXRpb24gb2JqZWN0CiAgICAgICAgIiIiCiAgICAgICAgZXhwbGFuYXRpb24gPSBBbmFseXNpc0V4cGxhbmF0aW9uKAogICAgICAgICAgICByZWNvZ25pemVyPXNlbGYuX19jbGFzc19fLl9fbmFtZV9fLAogICAgICAgICAgICBvcmlnaW5hbF9zY29yZT1vcmlnaW5hbF9zY29yZSwKICAgICAgICAgICAgdGV4dHVhbF9leHBsYW5hdGlvbj1leHBsYW5hdGlvbiwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGV4cGxhbmF0aW9uCgogICAgZGVmIGFuYWx5emUoc2VsZiwgdGV4dCwgZW50aXRpZXMsIG5scF9hcnRpZmFjdHM9Tm9uZSk6ICAjIG5vcWEgRDEwMgogICAgICAgICIiIgogICAgICAgIEFuYWx5emUgdGV4dCB1c2luZyBTcGFjeS4KICAgICAgICA6cGFyYW0gdGV4dDogVGV4dCB0byBhbmFseXplCiAgICAgICAgOnBhcmFtIGVudGl0aWVzOiBFbnRpdGllcyB0byBhbmFseXplCiAgICAgICAgOnBhcmFtIG5scF9hcnRpZmFjdHM6IE5MUCBhcnRpZmFjdHMgdG8gdXNlCiAgICAgICAgOnJldHVybnM6IExpc3Qgb2YgUmVjb2duaXplclJlc3VsdCBvYmplY3RzCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0cyA9IFtdCiAgICAgICAgaWYgbm90IG5scF9hcnRpZmFjdHM6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJTa2lwcGluZyBTcGFDeSwgbmxwIGFydGlmYWN0cyBub3QgcHJvdmlkZWQuLi4iKQogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwoKICAgICAgICBuZXJfZW50aXRpZXMgPSBubHBfYXJ0aWZhY3RzLmVudGl0aWVzCgogICAgICAgIGZvciBlbnRpdHkgaW4gZW50aXRpZXM6CiAgICAgICAgICAgIGlmIGVudGl0eSBub3QgaW4gc2VsZi5zdXBwb3J0ZWRfZW50aXRpZXM6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBmb3IgZW50IGluIG5lcl9lbnRpdGllczoKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9fY2hlY2tfbGFiZWwoZW50aXR5LCBlbnQubGFiZWxfLCBzZWxmLmNoZWNrX2xhYmVsX2dyb3Vwcyk6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHRleHR1YWxfZXhwbGFuYXRpb24gPSBzZWxmLkRFRkFVTFRfRVhQTEFOQVRJT04uZm9ybWF0KGVudC5sYWJlbF8pCiAgICAgICAgICAgICAgICBleHBsYW5hdGlvbiA9IHNlbGYuYnVpbGRfc3BhY3lfZXhwbGFuYXRpb24oCiAgICAgICAgICAgICAgICAgICAgc2VsZi5uZXJfc3RyZW5ndGgsIHRleHR1YWxfZXhwbGFuYXRpb24KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHNwYWN5X3Jlc3VsdCA9IFJlY29nbml6ZXJSZXN1bHQoCiAgICAgICAgICAgICAgICAgICAgZW50aXR5X3R5cGU9ZW50aXR5LAogICAgICAgICAgICAgICAgICAgIHN0YXJ0PWVudC5zdGFydF9jaGFyLAogICAgICAgICAgICAgICAgICAgIGVuZD1lbnQuZW5kX2NoYXIsCiAgICAgICAgICAgICAgICAgICAgc2NvcmU9c2VsZi5uZXJfc3RyZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgYW5hbHlzaXNfZXhwbGFuYXRpb249ZXhwbGFuYXRpb24sCiAgICAgICAgICAgICAgICAgICAgcmVjb2duaXRpb25fbWV0YWRhdGE9ewogICAgICAgICAgICAgICAgICAgICAgICBSZWNvZ25pemVyUmVzdWx0LlJFQ09HTklaRVJfTkFNRV9LRVk6IHNlbGYubmFtZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChzcGFjeV9yZXN1bHQpCgogICAgICAgIHJldHVybiByZXN1bHRzCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIF9fY2hlY2tfbGFiZWwoCiAgICAgICAgZW50aXR5OiBzdHIsIGxhYmVsOiBzdHIsIGNoZWNrX2xhYmVsX2dyb3VwczogVHVwbGVbU2V0LCBTZXRdCiAgICApIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ2hlY2sgaWYgdGhlIGxhYmVsIGlzIGluIHRoZSBsYWJlbCBncm91cC4KICAgICAgICA6cGFyYW0gZW50aXR5OiBFbnRpdHkgdG8gY2hlY2sKICAgICAgICA6cGFyYW0gbGFiZWw6IExhYmVsIHRvIGNoZWNrCiAgICAgICAgOnBhcmFtIGNoZWNrX2xhYmVsX2dyb3VwczogTGFiZWwgZ3JvdXBzIHRvIGNoZWNrCiAgICAgICAgOnJldHVybnM6IFRydWUgaWYgdGhlIGxhYmVsIGlzIGluIHRoZSBsYWJlbCBncm91cCwgRmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGFueSgKICAgICAgICAgICAgW2VudGl0eSBpbiBlZ3JwIGFuZCBsYWJlbCBpbiBsZ3JwIGZvciBlZ3JwLCBsZ3JwIGluIGNoZWNrX2xhYmVsX2dyb3Vwc10KICAgICAgICApCgoKY2xhc3MgRmxhaXJSZWNvZ25pemVyKEVudGl0eVJlY29nbml6ZXIpOgogICAgIiIiCiAgICBXcmFwcGVyIGZvciBhIGZsYWlyIG1vZGVsLCBpZiBuZWVkZWQgdG8gYmUgdXNlZCB3aXRoaW4gUHJlc2lkaW8gQW5hbHl6ZXIuCiAgICAiIiIKCiAgICBFTlRJVElFUyA9IFsKICAgICAgICAiTE9DQVRJT04iLAogICAgICAgICJQRVJTT04iLAogICAgICAgICJOUlAiLAogICAgICAgICJHUEUiLAogICAgICAgICJPUkdBTklaQVRJT04iLAogICAgICAgICJNQUNfQUREUkVTUyIsCiAgICAgICAgIlVTX0JBTktfTlVNQkVSIiwKICAgICAgICAiSU1FSSIsCiAgICAgICAgIlRJVExFIiwKICAgICAgICAiTElDRU5TRV9QTEFURSIsCiAgICAgICAgIlVTX1BBU1NQT1JUIiwKICAgICAgICAiQ1VSUkVOQ1kiLAogICAgICAgICJST1VUSU5HX05VTUJFUiIsCiAgICAgICAgIlVTX0lUSU4iLAogICAgICAgICJVU19CQU5LX05VTUJFUiIsCiAgICAgICAgIlVTX0RSSVZFUl9MSUNFTlNFIiwKICAgICAgICAiQUdFIiwKICAgICAgICAiUEFTU1dPUkQiLAogICAgICAgICJTV0lGVF9DT0RFIiwKICAgIF0KCiAgICBERUZBVUxUX0VYUExBTkFUSU9OID0gIklkZW50aWZpZWQgYXMge30gYnkgRmxhaXIncyBOYW1lZCBFbnRpdHkgUmVjb2duaXRpb24iCgogICAgQ0hFQ0tfTEFCRUxfR1JPVVBTID0gWwogICAgICAgICh7IkxPQ0FUSU9OIn0sIHsiTE9DIiwgIkxPQ0FUSU9OIiwgIlNUUkVFVF9BRERSRVNTIiwgIkNPT1JESU5BVEUifSksCiAgICAgICAgKHsiUEVSU09OIn0sIHsiUEVSIiwgIlBFUlNPTiJ9KSwKICAgICAgICAoeyJOUlAifSwgeyJOT1JQIiwgIk5SUCJ9KSwKICAgICAgICAoeyJHUEUifSwgeyJHUEUifSksCiAgICAgICAgKHsiT1JHQU5JWkFUSU9OIn0sIHsiT1JHIn0pLAogICAgICAgICh7Ik1BQ19BRERSRVNTIn0sIHsiTUFDX0FERFJFU1MifSksCiAgICAgICAgKHsiVVNfQkFOS19OVU1CRVIifSwgeyJVU19CQU5LX05VTUJFUiJ9KSwKICAgICAgICAoeyJJTUVJIn0sIHsiSU1FSSJ9KSwKICAgICAgICAoeyJUSVRMRSJ9LCB7IlRJVExFIn0pLAogICAgICAgICh7IkxJQ0VOU0VfUExBVEUifSwgeyJMSUNFTlNFX1BMQVRFIn0pLAogICAgICAgICh7IlVTX1BBU1NQT1JUIn0sIHsiVVNfUEFTU1BPUlQifSksCiAgICAgICAgKHsiQ1VSUkVOQ1kifSwgeyJDVVJSRU5DWSJ9KSwKICAgICAgICAoeyJST1VUSU5HX05VTUJFUiJ9LCB7IlJPVVRJTkdfTlVNQkVSIn0pLAogICAgICAgICh7IkFHRSJ9LCB7IkFHRSJ9KSwKICAgICAgICAoeyJDVVJSRU5DWSJ9LCB7IkNVUlJFTkNZIn0pLAogICAgICAgICh7IlNXSUZUX0NPREUifSwgeyJTV0lGVF9DT0RFIn0pLAogICAgICAgICh7IlVTX0lUSU4ifSwgeyJVU19JVElOIn0pLAogICAgICAgICh7IlVTX0JBTktfTlVNQkVSIn0sIHsiVVNfQkFOS19OVU1CRVIifSksCiAgICAgICAgKHsiVVNfRFJJVkVSX0xJQ0VOU0UifSwgeyJVU19EUklWRVJfTElDRU5TRSJ9KSwKICAgIF0KCiAgICBNT0RFTF9MQU5HVUFHRVMgPSB7CiAgICAgICAgImVuIjogImJla2kvZmxhaXItcGlpLWRpc3RpbGJlcnQiLAogICAgICAgICMgImVuIjoiZmxhaXItdHJmLnB0IiwKICAgIH0KCiAgICBQUkVTSURJT19FUVVJVkFMRU5DRVMgPSB7CiAgICAgICAgIlBFUiI6ICJQRVJTT04iLAogICAgICAgICJMT0MiOiAiTE9DQVRJT04iLAogICAgICAgICJPUkciOiAiT1JHQU5JWkFUSU9OIiwKICAgICAgICAiTlJPUCI6ICJOUlAiLAogICAgICAgICJVUkwiOiAiVVJMIiwKICAgICAgICAiVVNfSVRJTiI6ICJVU19JVElOIiwKICAgICAgICAiVVNfUEFTU1BPUlQiOiAiVVNfUEFTU1BPUlQiLAogICAgICAgICJJQkFOX0NPREUiOiAiSUJBTl9DT0RFIiwKICAgICAgICAiSVBfQUREUkVTUyI6ICJJUF9BRERSRVNTIiwKICAgICAgICAiRU1BSUxfQUREUkVTUyI6ICJFTUFJTCIsCiAgICAgICAgIlVTX0RSSVZFUl9MSUNFTlNFIjogIlVTX0RSSVZFUl9MSUNFTlNFIiwKICAgICAgICAiVVNfQkFOS19OVU1CRVIiOiAiVVNfQkFOS19OVU1CRVIiLAogICAgfQoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIHN1cHBvcnRlZF9sYW5ndWFnZTogc3RyID0gImVuIiwKICAgICAgICBzdXBwb3J0ZWRfZW50aXRpZXM6IE9wdGlvbmFsW0xpc3Rbc3RyXV0gPSBOb25lLAogICAgICAgIGNoZWNrX2xhYmVsX2dyb3VwczogT3B0aW9uYWxbVHVwbGVbU2V0LCBTZXRdXSA9IE5vbmUsCiAgICAgICAgbW9kZWw6IFNlcXVlbmNlVGFnZ2VyID0gTm9uZSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgSW5pdGlhbGl6ZSB0aGUgRmxhaXJSZWNvZ25pemVyLgogICAgICAgIDpwYXJhbSBzdXBwb3J0ZWRfbGFuZ3VhZ2U6IExhbmd1YWdlIHRvIHVzZQogICAgICAgIDpwYXJhbSBzdXBwb3J0ZWRfZW50aXRpZXM6IEVudGl0aWVzIHRvIHVzZQogICAgICAgIDpwYXJhbSBjaGVja19sYWJlbF9ncm91cHM6IExhYmVsIGdyb3VwcyB0byBjaGVjawogICAgICAgIDpwYXJhbSBtb2RlbDogRmxhaXIgbW9kZWwgdG8gdXNlCiAgICAgICAgOnJldHVybnM6IEZsYWlyUmVjb2duaXplciBvYmplY3QKCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5jaGVja19sYWJlbF9ncm91cHMgPSAoCiAgICAgICAgICAgIGNoZWNrX2xhYmVsX2dyb3VwcyBpZiBjaGVja19sYWJlbF9ncm91cHMgZWxzZSBzZWxmLkNIRUNLX0xBQkVMX0dST1VQUwogICAgICAgICkKCiAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzID0gc3VwcG9ydGVkX2VudGl0aWVzIGlmIHN1cHBvcnRlZF9lbnRpdGllcyBlbHNlIHNlbGYuRU5USVRJRVMKICAgICAgICBzZWxmLm1vZGVsID0gKAogICAgICAgICAgICBtb2RlbAogICAgICAgICAgICBpZiBtb2RlbAogICAgICAgICAgICBlbHNlIFNlcXVlbmNlVGFnZ2VyLmxvYWQoc2VsZi5NT0RFTF9MQU5HVUFHRVMuZ2V0KHN1cHBvcnRlZF9sYW5ndWFnZSkpCiAgICAgICAgKQoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKAogICAgICAgICAgICBzdXBwb3J0ZWRfZW50aXRpZXM9c3VwcG9ydGVkX2VudGl0aWVzLAogICAgICAgICAgICBzdXBwb3J0ZWRfbGFuZ3VhZ2U9c3VwcG9ydGVkX2xhbmd1YWdlLAogICAgICAgICAgICBuYW1lPSJGbGFpciBBbmFseXRpY3MiLAogICAgICAgICkKCiAgICBkZWYgbG9hZChzZWxmKSAtPiBOb25lOgogICAgICAgICIiIkxvYWQgdGhlIG1vZGVsLCBub3QgdXNlZC4gTW9kZWwgaXMgbG9hZGVkIGR1cmluZyBpbml0aWFsaXphdGlvbi4iIiIKICAgICAgICBwYXNzCgogICAgZGVmIGdldF9zdXBwb3J0ZWRfZW50aXRpZXMoc2VsZikgLT4gTGlzdFtzdHJdOgogICAgICAgICIiIgogICAgICAgIFJldHVybiBzdXBwb3J0ZWQgZW50aXRpZXMgYnkgdGhpcyBtb2RlbC4KICAgICAgICA6cmV0dXJuczogTGlzdCBvZiB0aGUgc3VwcG9ydGVkIGVudGl0aWVzLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLnN1cHBvcnRlZF9lbnRpdGllcwoKICAgICMgQ2xhc3MgdG8gdXNlIEZsYWlyIHdpdGggUHJlc2lkaW8gYXMgYW4gZXh0ZXJuYWwgcmVjb2duaXplci4KICAgIGRlZiBhbmFseXplKAogICAgICAgIHNlbGYsIHRleHQ6IHN0ciwgZW50aXRpZXM6IExpc3Rbc3RyXSwgbmxwX2FydGlmYWN0czogTmxwQXJ0aWZhY3RzID0gTm9uZQogICAgKSAtPiBMaXN0W1JlY29nbml6ZXJSZXN1bHRdOgogICAgICAgICIiIgogICAgICAgIEFuYWx5emUgdGV4dCB1c2luZyBUZXh0IEFuYWx5dGljcy4KICAgICAgICA6cGFyYW0gdGV4dDogVGhlIHRleHQgZm9yIGFuYWx5c2lzLgogICAgICAgIDpwYXJhbSBlbnRpdGllczogTm90IHdvcmtpbmcgcHJvcGVybHkgZm9yIHRoaXMgcmVjb2duaXplci4KICAgICAgICA6cGFyYW0gbmxwX2FydGlmYWN0czogTm90IHVzZWQgYnkgdGhpcyByZWNvZ25pemVyLgogICAgICAgIDpwYXJhbSBsYW5ndWFnZTogVGV4dCBsYW5ndWFnZS4gU3VwcG9ydGVkIGxhbmd1YWdlcyBpbiBNT0RFTF9MQU5HVUFHRVMKICAgICAgICA6cmV0dXJuczogVGhlIGxpc3Qgb2YgUHJlc2lkaW8gUmVjb2duaXplclJlc3VsdCBjb25zdHJ1Y3RlZCBmcm9tIHRoZSByZWNvZ25pemVkCiAgICAgICAgICAgIEZsYWlyIGRldGVjdGlvbnMuCiAgICAgICAgIiIiCgogICAgICAgIHJlc3VsdHMgPSBbXQoKICAgICAgICBzZW50ZW5jZXMgPSBTZW50ZW5jZSh0ZXh0KQogICAgICAgIHNlbGYubW9kZWwucHJlZGljdChzZW50ZW5jZXMpCgogICAgICAgICMgSWYgdGhlcmUgYXJlIG5vIHNwZWNpZmljIGxpc3Qgb2YgZW50aXRpZXMsIHdlIHdpbGwgbG9vayBmb3IgYWxsIG9mIGl0LgogICAgICAgIGlmIG5vdCBlbnRpdGllczoKICAgICAgICAgICAgZW50aXRpZXMgPSBzZWxmLnN1cHBvcnRlZF9lbnRpdGllcwoKICAgICAgICBmb3IgZW50aXR5IGluIGVudGl0aWVzOgogICAgICAgICAgICBpZiBlbnRpdHkgbm90IGluIHNlbGYuc3VwcG9ydGVkX2VudGl0aWVzOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGZvciBlbnQgaW4gc2VudGVuY2VzLmdldF9zcGFucygibmVyIik6CiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5fX2NoZWNrX2xhYmVsKAogICAgICAgICAgICAgICAgICAgIGVudGl0eSwgZW50LmxhYmVsc1swXS52YWx1ZSwgc2VsZi5jaGVja19sYWJlbF9ncm91cHMKICAgICAgICAgICAgICAgICk6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHRleHR1YWxfZXhwbGFuYXRpb24gPSBzZWxmLkRFRkFVTFRfRVhQTEFOQVRJT04uZm9ybWF0KAogICAgICAgICAgICAgICAgICAgIGVudC5sYWJlbHNbMF0udmFsdWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGV4cGxhbmF0aW9uID0gc2VsZi5idWlsZF9mbGFpcl9leHBsYW5hdGlvbigKICAgICAgICAgICAgICAgICAgICByb3VuZChlbnQuc2NvcmUsIDIpLCB0ZXh0dWFsX2V4cGxhbmF0aW9uCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBmbGFpcl9yZXN1bHQgPSBzZWxmLl9jb252ZXJ0X3RvX3JlY29nbml6ZXJfcmVzdWx0KGVudCwgZXhwbGFuYXRpb24pCgogICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoZmxhaXJfcmVzdWx0KQoKICAgICAgICByZXR1cm4gcmVzdWx0cwoKICAgIGRlZiBfY29udmVydF90b19yZWNvZ25pemVyX3Jlc3VsdChzZWxmLCBlbnRpdHksIGV4cGxhbmF0aW9uKSAtPiBSZWNvZ25pemVyUmVzdWx0OgogICAgICAgICIiIgogICAgICAgIENvbnZlcnQgRmxhaXIgcmVzdWx0IHRvIFByZXNpZGlvIFJlY29nbml6ZXJSZXN1bHQuCiAgICAgICAgOnBhcmFtIGVudGl0eTogRmxhaXIgZW50aXR5CiAgICAgICAgOnBhcmFtIGV4cGxhbmF0aW9uOiBBbmFseXNpc0V4cGxhbmF0aW9uCiAgICAgICAgOnJldHVybnM6IFJlY29nbml6ZXJSZXN1bHQKICAgICAgICAiIiIKICAgICAgICBlbnRpdHlfdHlwZSA9IHNlbGYuUFJFU0lESU9fRVFVSVZBTEVOQ0VTLmdldChlbnRpdHkudGFnLCBlbnRpdHkudGFnKQogICAgICAgIGZsYWlyX3Njb3JlID0gcm91bmQoZW50aXR5LnNjb3JlLCAyKQoKICAgICAgICBmbGFpcl9yZXN1bHRzID0gUmVjb2duaXplclJlc3VsdCgKICAgICAgICAgICAgZW50aXR5X3R5cGU9ZW50aXR5X3R5cGUsCiAgICAgICAgICAgIHN0YXJ0PWVudGl0eS5zdGFydF9wb3NpdGlvbiwKICAgICAgICAgICAgZW5kPWVudGl0eS5lbmRfcG9zaXRpb24sCiAgICAgICAgICAgIHNjb3JlPWZsYWlyX3Njb3JlLAogICAgICAgICAgICBhbmFseXNpc19leHBsYW5hdGlvbj1leHBsYW5hdGlvbiwKICAgICAgICApCgogICAgICAgIHJldHVybiBmbGFpcl9yZXN1bHRzCgogICAgZGVmIGJ1aWxkX2ZsYWlyX2V4cGxhbmF0aW9uKAogICAgICAgIHNlbGYsIG9yaWdpbmFsX3Njb3JlOiBmbG9hdCwgZXhwbGFuYXRpb246IHN0cgogICAgKSAtPiBBbmFseXNpc0V4cGxhbmF0aW9uOgogICAgICAgICIiIgogICAgICAgIENyZWF0ZSBleHBsYW5hdGlvbiBmb3Igd2h5IHRoaXMgcmVzdWx0IHdhcyBkZXRlY3RlZC4KICAgICAgICA6cGFyYW0gb3JpZ2luYWxfc2NvcmU6IFNjb3JlIGdpdmVuIGJ5IHRoaXMgcmVjb2duaXplcgogICAgICAgIDpwYXJhbSBleHBsYW5hdGlvbjogRXhwbGFuYXRpb24gc3RyaW5nCiAgICAgICAgOnJldHVybnM6IEFuYWx5c2lzRXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICBleHBsYW5hdGlvbiA9IEFuYWx5c2lzRXhwbGFuYXRpb24oCiAgICAgICAgICAgIHJlY29nbml6ZXI9c2VsZi5fX2NsYXNzX18uX19uYW1lX18sCiAgICAgICAgICAgIG9yaWdpbmFsX3Njb3JlPW9yaWdpbmFsX3Njb3JlLAogICAgICAgICAgICB0ZXh0dWFsX2V4cGxhbmF0aW9uPWV4cGxhbmF0aW9uLAogICAgICAgICkKICAgICAgICByZXR1cm4gZXhwbGFuYXRpb24KCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX19jaGVja19sYWJlbCgKICAgICAgICBlbnRpdHk6IHN0ciwgbGFiZWw6IHN0ciwgY2hlY2tfbGFiZWxfZ3JvdXBzOiBUdXBsZVtTZXQsIFNldF0KICAgICkgLT4gYm9vbDoKICAgICAgICByZXR1cm4gYW55KAogICAgICAgICAgICBbZW50aXR5IGluIGVncnAgYW5kIGxhYmVsIGluIGxncnAgZm9yIGVncnAsIGxncnAgaW4gY2hlY2tfbGFiZWxfZ3JvdXBzXQogICAgICAgICkKCgpkZWYgYW5hbHl6ZXJfZW5naW5lKG1vZGVsPSJ3aG9sZSIpOgogICAgIiIiUmV0dXJuIEFuYWx5emVyRW5naW5lLgogICAgOnBhcmFtIG1vZGVsOiBUaGUgbW9kZWwgdG8gdXNlLiBDYW4gYmUgInNwYWN5IiwgImZsYWlyIiwgInBhdHRlcm4iIG9yICJ3aG9sZSIuCiAgICA6cmV0dXJuczogQW5hbHl6ZXJFbmdpbmUKICAgICIiIgogICAgcmVnaXN0cnkgPSBSZWNvZ25pemVyUmVnaXN0cnkoKQoKICAgIHNwYWN5X3JlY29nbml6ZXIgPSBDdXN0b21TcGFjeVJlY29nbml6ZXIoKQoKICAgIGZsYWlyX3JlY29nbml6ZXIgPSBGbGFpclJlY29nbml6ZXIoKQoKICAgIGlmIG1vZGVsID09ICJzcGFjeSI6CiAgICAgICAgIyBhZGQgdGhlIGN1c3RvbSBidWlsZCBzcGFjeSByZWNvZ25pemVyCiAgICAgICAgcmVnaXN0cnkuYWRkX3JlY29nbml6ZXIoc3BhY3lfcmVjb2duaXplcikKICAgIGlmIG1vZGVsID09ICJmbGFpciI6CiAgICAgICAgIyBhZGQgdGhlIGN1c3RvbSBidWlsZCBmbGFpciByZWNvZ25pemVyCiAgICAgICAgcmVnaXN0cnkuYWRkX3JlY29nbml6ZXIoZmxhaXJfcmVjb2duaXplcikKICAgIGlmIG1vZGVsID09ICJwYXR0ZXJuIjoKICAgICAgICAjIGFkZCB0aGUgcGF0dGVybiByZWNvZ25pemVyCiAgICAgICAgcGF0dGVybl9yZWNvZ25pemVyX2ZhY3RvcnkgPSBQYXR0ZXJuUmVjb2duaXplckZhY3RvcnkoKQogICAgICAgIGZvciByZWNvZ25pemVyIGluIHBhdHRlcm5fcmVjb2duaXplcl9mYWN0b3J5LmNyZWF0ZV9wYXR0ZXJuX3JlY29nbml6ZXIoKToKICAgICAgICAgICAgcmVnaXN0cnkuYWRkX3JlY29nbml6ZXIocmVjb2duaXplcikKICAgIGlmIG1vZGVsID09ICJ3aG9sZSI6CiAgICAgICAgcmVnaXN0cnkuYWRkX3JlY29nbml6ZXIoc3BhY3lfcmVjb2duaXplcikKICAgICAgICByZWdpc3RyeS5hZGRfcmVjb2duaXplcihmbGFpcl9yZWNvZ25pemVyKQogICAgICAgICMgYWRkIHRoZSBwYXR0ZXJuIHJlY29nbml6ZXIKICAgICAgICBwYXR0ZXJuX3JlY29nbml6ZXJfZmFjdG9yeSA9IFBhdHRlcm5SZWNvZ25pemVyRmFjdG9yeSgpCiAgICAgICAgZm9yIHJlY29nbml6ZXIgaW4gcGF0dGVybl9yZWNvZ25pemVyX2ZhY3RvcnkuY3JlYXRlX3BhdHRlcm5fcmVjb2duaXplcigpOgogICAgICAgICAgICByZWdpc3RyeS5hZGRfcmVjb2duaXplcihyZWNvZ25pemVyKQoKICAgIGFuYWx5emVyID0gQW5hbHl6ZXJFbmdpbmUocmVnaXN0cnk9cmVnaXN0cnksIHN1cHBvcnRlZF9sYW5ndWFnZXM9WyJlbiJdKQogICAgcmV0dXJuIGFuYWx5emVyCgoKZGVmIGFub255bWl6ZXJfZW5naW5lKCk6CiAgICAiIiJSZXR1cm4gQW5vbnltaXplckVuZ2luZS4KICAgIDpyZXR1cm5zOiBUaGUgQW5vbnltaXplckVuZ2luZS4KICAgICIiIgogICAgcmV0dXJuIEFub255bWl6ZXJFbmdpbmUoKQoKCmRlZiBnZXRfc3VwcG9ydGVkX2VudGl0aWVzKCk6CiAgICAiIiJSZXR1cm4gc3VwcG9ydGVkIGVudGl0aWVzIGZyb20gdGhlIEFuYWx5emVyIEVuZ2luZS4KICAgIDpyZXR1cm5zOiBUaGUgbGlzdCBvZiBzdXBwb3J0ZWQgZW50aXRpZXMuCiAgICAiIiIKICAgIHJldHVybiBhbmFseXplcl9lbmdpbmUoKS5nZXRfc3VwcG9ydGVkX2VudGl0aWVzKCkKCgpkZWYgYW5hbHl6ZSgqKmt3YXJncyk6CiAgICAiIiJBbmFseXplIGlucHV0IHVzaW5nIEFuYWx5emVyIGVuZ2luZSBhbmQgaW5wdXQgYXJndW1lbnRzIChrd2FyZ3MpLgogICAgOnBhcmFtIGt3YXJnczogVGhlIGlucHV0IGFyZ3VtZW50cyBmb3IgdGhlIGFuYWx5emVyIGVuZ2luZS4KICAgIDpyZXR1cm5zOiBUaGUgbGlzdCBvZiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGNvbnN0cnVjdGVkIGZyb20gdGhlIHJlY29nbml6ZWQKICAgICIiIgogICAgaWYgImVudGl0aWVzIiBub3QgaW4ga3dhcmdzIG9yICJBbGwiIGluIGt3YXJnc1siZW50aXRpZXMiXToKICAgICAgICBrd2FyZ3NbImVudGl0aWVzIl0gPSBOb25lCiAgICByZXR1cm4gYW5hbHl6ZXJfZW5naW5lKCkuYW5hbHl6ZSgqKmt3YXJncykKCgpkZWYgYW5vbnltaXplKHRleHQsIGFuYWx5emVfcmVzdWx0cyk6CiAgICAiIiJBbm9ueW1pemUgaWRlbnRpZmllZCBpbnB1dCB1c2luZyBQcmVzaWRpbyBBYm9ueW1pemVyLgogICAgOnBhcmFtIHRleHQ6IFRoZSB0ZXh0IGZvciBhbmFseXNpcy4KICAgIDpwYXJhbSBhbmFseXplX3Jlc3VsdHM6IFRoZSBsaXN0IG9mIFByZXNpZGlvIFJlY29nbml6ZXJSZXN1bHQgY29uc3RydWN0ZWQgZnJvbQogICAgOnJldHVybnM6IFRoZSBhbm9ueW1pemVkIHRleHQuCiAgICAiIiIKICAgIGlmIG5vdCB0ZXh0OgogICAgICAgIHJldHVybgogICAgcmVzID0gYW5vbnltaXplcl9lbmdpbmUoKS5hbm9ueW1pemUodGV4dCwgYW5hbHl6ZV9yZXN1bHRzKQogICAgcmV0dXJuIHJlcy50ZXh0CgoKZGVmIGFubm90YXRlKHRleHQsIHN0X2FuYWx5emVfcmVzdWx0cywgc3RfZW50aXRpZXMpOgogICAgIiIiQW5ub3RhdGUgaWRlbnRpZmllZCBpbnB1dCB1c2luZyBQcmVzaWRpbyBBbm9ueW1pemVyLgogICAgOnBhcmFtIHRleHQ6IFRoZSB0ZXh0IGZvciBhbmFseXNpcy4KICAgIDpwYXJhbSBzdF9hbmFseXplX3Jlc3VsdHM6IFRoZSBsaXN0IG9mIFByZXNpZGlvIFJlY29nbml6ZXJSZXN1bHQgY29uc3RydWN0ZWQgZnJvbQogICAgOnJldHVybnM6IFRoZSBsaXN0IG9mIHRva2VucyB3aXRoIHRoZSBpZGVudGlmaWVkIGVudGl0aWVzLgoKICAgICIiIgogICAgdG9rZW5zID0gW10KICAgICMgc29ydCBieSBzdGFydCBpbmRleAogICAgcmVzdWx0cyA9IHNvcnRlZChzdF9hbmFseXplX3Jlc3VsdHMsIGtleT1sYW1iZGEgeDogeC5zdGFydCkKICAgIGZvciBpLCByZXMgaW4gZW51bWVyYXRlKHJlc3VsdHMpOgogICAgICAgIGlmIGkgPT0gMDoKICAgICAgICAgICAgdG9rZW5zLmFwcGVuZCh0ZXh0WzogcmVzLnN0YXJ0XSkKCiAgICAgICAgIyBhcHBlbmQgZW50aXR5IHRleHQgYW5kIGVudGl0eSB0eXBlCiAgICAgICAgdG9rZW5zLmFwcGVuZCgodGV4dFtyZXMuc3RhcnQgOiByZXMuZW5kXSwgcmVzLmVudGl0eV90eXBlKSkKCiAgICAgICAgIyBpZiBhbm90aGVyIGVudGl0eSBjb21pbmcgaS5lLiB3ZSdyZSBub3QgYXQgdGhlIGxhc3QgcmVzdWx0cyBlbGVtZW50LAogICAgICAgICMgYWRkIHRleHQgdXAgdG8gbmV4dCBlbnRpdHkKICAgICAgICBpZiBpICE9IGxlbihyZXN1bHRzKSAtIDE6CiAgICAgICAgICAgIHRva2Vucy5hcHBlbmQodGV4dFtyZXMuZW5kIDogcmVzdWx0c1tpICsgMV0uc3RhcnRdKQogICAgICAgICMgaWYgbm8gbW9yZSBlbnRpdGllcyBjb21pbmcsIGFkZCBhbGwgcmVtYWluaW5nIHRleHQKICAgICAgICBlbHNlOgogICAgICAgICAgICB0b2tlbnMuYXBwZW5kKHRleHRbcmVzLmVuZCA6XSkKICAgIHJldHVybiB0b2tlbnMKCgpjbGFzcyBDdXN0b21FbmNvZGVyKEpTT05FbmNvZGVyKToKICAgICIiIkN1c3RvbSBlbmNvZGVyIGZvciBKU09ORW5jb2Rlci4KICAgIDpwYXJhbSBKU09ORW5jb2RlcjogVGhlIEpTT05FbmNvZGVyLgogICAgOnJldHVybnM6IFRoZSBKU09ORW5jb2Rlci4KICAgICIiIgoKICAgIGRlZiBkZWZhdWx0KHNlbGYsIG8pOgogICAgICAgIHJldHVybiBvLl9fZGljdF9fCgoKZGVmIHByb2Nlc3ModGV4dDogc3RyLCBtb2RlbDogc3RyID0gIndob2xlIik6CiAgICAiIiIKICAgIFByb2Nlc3MgdGhlIHRleHQgb2Ygc3RyIHVzaW5nIHRoZSBtb2RlbC4KICAgIDpwYXJhbSB0eHQ6IFRleHQgdG8gcHJvY2VzcwogICAgOnBhcmFtIG1vZGVsOiBNb2RlbCB0byB1c2UgZm9yIHByb2Nlc3NpbmcKICAgIDpyZXR1cm5zOiBUaGUgYW5vbnltaXplZCB0ZXh0LCB0aGUgaHRtbCBzdHJpbmcgYW5kIHRoZSBzdGF0cyByZXBvcnQuCiAgICAiIiIKICAgIGFuYWx5emVyID0gYW5hbHl6ZXJfZW5naW5lKG1vZGVsKQogICAgcmVzdWx0cyA9IGFuYWx5emVyLmFuYWx5emUoCiAgICAgICAgdGV4dD10ZXh0LAogICAgICAgIGxhbmd1YWdlPSJlbiIsCiAgICAgICAgZW50aXRpZXM9Z2V0X3N1cHBvcnRlZF9lbnRpdGllcygpLAogICAgICAgIHJldHVybl9kZWNpc2lvbl9wcm9jZXNzPVRydWUsCiAgICApCiAgICBhbm9ueW1pemVkX3RleHQgPSBhbm9ueW1pemUodGV4dCwgcmVzdWx0cykKCiAgICBhbm5vdGF0ZWRfdG9rZW5zID0gYW5ub3RhdGUodGV4dCwgcmVzdWx0cywgZ2V0X3N1cHBvcnRlZF9lbnRpdGllcygpKQogICAgaHRtbCA9IGdldF9hbm5vdGF0ZWRfaHRtbCgqYW5ub3RhdGVkX3Rva2VucykKICAgIGJhY2tzbGFzaF9jaGFyID0gIlxcIgoKICAgIGh0bWxfc3RyID0gZiI8aHRtbD48Ym9keT48cD57aHRtbC5yZXBsYWNlKCd7YmFja3NsYXNoX2NoYXJ9bicsICc8YnI+Jyl9PC9wPjwvYm9keT48L2h0bWw+IgoKICAgIHN0YXRzID0gcmVzdWx0cwoKICAgIHJldHVybiBhbm9ueW1pemVkX3RleHQsIGh0bWxfc3RyLCBzdGF0cwo=
    commands: []
    code_origin: git@github.com-personal:pengwei715/pii_masker.git#370a7a9ee3769772c0d6294e9daa1c7fbd295364:pii_recognizer.py
    origin_filename: pii_recognizer.py
  entry_points:
    create_pattern_recognizer:
      name: create_pattern_recognizer
      doc: ''
      parameters: []
      outputs:
      - default: ''
      lineno: 43
    load:
      name: load
      doc: Load the model, not used. Model is loaded during initialization.
      parameters:
      - name: self
        default: ''
      outputs:
      - default: ''
      lineno: 296
    get_supported_entities:
      name: get_supported_entities
      doc: Return supported entities from the Analyzer Engine.
      parameters: []
      outputs:
      - default: ''
        doc: The list of supported entities.
      lineno: 437
    build_spacy_explanation:
      name: build_spacy_explanation
      doc: Create explanation for why this result was detected.
      parameters:
      - name: self
        default: ''
      - name: original_score
        type: float
        doc: Score given by this recognizer
        default: ''
      - name: explanation
        type: str
        doc: Explanation string
        default: ''
      outputs:
      - default: ''
        doc: AnalysisExplanation object
        type: AnalysisExplanation
      lineno: 121
    analyze:
      name: analyze
      doc: Analyze input using Analyzer engine and input arguments (kwargs).
      parameters: []
      outputs:
      - default: ''
        doc: The list of Presidio RecognizerResult constructed from the recognized
      lineno: 444
    build_flair_explanation:
      name: build_flair_explanation
      doc: Create explanation for why this result was detected.
      parameters:
      - name: self
        default: ''
      - name: original_score
        type: float
        doc: Score given by this recognizer
        default: ''
      - name: explanation
        type: str
        doc: Explanation string
        default: ''
      outputs:
      - default: ''
        doc: AnalysisExplanation
        type: AnalysisExplanation
      lineno: 371
    analyzer_engine:
      name: analyzer_engine
      doc: Return AnalyzerEngine.
      parameters:
      - name: model
        doc: The model to use. Can be "spacy", "flair", "pattern" or "whole".
        default: whole
      outputs:
      - default: ''
        doc: AnalyzerEngine
      lineno: 396
    anonymizer_engine:
      name: anonymizer_engine
      doc: Return AnonymizerEngine.
      parameters: []
      outputs:
      - default: ''
        doc: The AnonymizerEngine.
      lineno: 430
    anonymize:
      name: anonymize
      doc: Anonymize identified input using Presidio Abonymizer.
      parameters:
      - name: text
        doc: The text for analysis.
        default: ''
      - name: analyze_results
        doc: The list of Presidio RecognizerResult constructed from
        default: ''
      outputs:
      - default: ''
        doc: The anonymized text.
      lineno: 454
    annotate:
      name: annotate
      doc: Annotate identified input using Presidio Anonymizer.
      parameters:
      - name: text
        doc: The text for analysis.
        default: ''
      - name: st_analyze_results
        doc: The list of Presidio RecognizerResult constructed from
        default: ''
      - name: st_entities
        default: ''
      outputs:
      - default: ''
        doc: The list of tokens with the identified entities.
      lineno: 466
    default:
      name: default
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: o
        default: ''
      outputs:
      - default: ''
      lineno: 499
    process:
      name: process
      doc: Process the text of str using the model.
      parameters:
      - name: text
        type: str
        default: ''
      - name: model
        type: str
        doc: Model to use for processing
        default: whole
      outputs:
      - default: ''
        doc: The anonymized text, the html string and the stats report.
      lineno: 503
  description: This function is used to recognize PII in a given text
  default_handler: process
  disable_auto_mount: false
  env: []
  resources:
    requests:
      memory: 1Mi
      cpu: 25m
    limits:
      memory: 20Gi
      cpu: '2'
  priority_class_name: igz-workload-medium
  preemption_mode: prevent
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: app.iguazio.com/lifecycle
            operator: NotIn
            values:
            - preemptible
          - key: eks.amazonaws.com/capacityType
            operator: NotIn
            values:
            - SPOT
          - key: node-lifecycle
            operator: NotIn
            values:
            - spot
  tolerations: null
  security_context: {}
verbose: false
